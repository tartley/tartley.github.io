<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Creating a website devoted to oneself has been described as the greatest act of hubris. Welcome aboard!">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>tartley.com (old posts, page 20) | tartley.com</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="rss.xml">
<link rel="canonical" href="https://www.tartley.com/index-20.html">
<link rel="icon" href="welcome.gif" sizes="16x16">
<link rel="prev" href="index-21.html" type="text/html">
<link rel="next" href="index-19.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://www.tartley.com/">

                <span id="blog-title">tartley.com</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>
                </li>
<li>
<a href="rss.xml">RSS feed</a>
                </li>
<li>
<a href="pages/about/">About</a>

                
            </li>
</ul>
<!-- DuckDuckGo custom search --><form method="get" id="search" action="https://duckduckgo.com/" class="navbar-form pull-left">
<input type="hidden" name="sites" value="https://tartley.com/"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" name="q" maxlength="255" placeholder="Searchâ€¦" class="span2" style="margin-top: 4px;"><input type="submit" value="DuckDuckGo Search" style="visibility: hidden;">
</form>
<!-- End of custom search -->


            <ul class="nav navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
    
    <a rel="me" href="https://mastodon.social/@tartley"></a>
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/django-testing-201-acceptance-tests-vs-unit-tests/" class="u-url">Django testing 201 : Acceptance Tests vs Unit Tests</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/django-testing-201-acceptance-tests-vs-unit-tests/" rel="bookmark">
            <time class="published dt-published" datetime="2011-07-14T16:19:43-05:00" itemprop="datePublished" title="2011-07-14 16:19">2011-07-14 16:19</time></a>
            </p>
                <p class="commentline">            <a href="posts/django-testing-201-acceptance-tests-vs-unit-tests/#disqus_thread" data-disqus-identifier="cache/posts/django-testing-201-acceptance-tests-vs-unit-tests.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>I'm finding that our Django project's tests fall into an uncomfortable
middle-ground, halfway between end-to-end acceptance tests and proper
unit tests. As such they don't exhibit the best qualities of either. I'd
like to fix this.</p>
<p>We're testing our Django application in what I believe is the canonical
way, as described by the <a href="https://docs.djangoproject.com/en/dev/topics/testing/">excellent
documentation</a>.
We have a half-dozen Django applications, with a mixture of
<code>unittest.TestCase</code> and <code>django.test.TestCase</code> subclasses in each
application's tests.py module. They generally use fixtures or the Django
ORM to set up data for the test, then invoke the function-under-test,
and then make assertions about return values or side-effects, often
using the ORM again to assert about the new state of the database.</p>
<h3>Not an Acceptance Test</h3>
<p>Such a test doesn't provide the primary benefit of an acceptance test,
namely proof that the application actually works, because it isn't quite
end-to-end enough. Instead of calling methods-under-test, we should be
using the Django testing client to make HTTP requests to our web
services, and maybe incorporating Selenium tests to drive our web UI.
This change is a lot of work, but at least the path forward seems clear.</p>
<p>However, an additional problem is that acceptance tests ought to be
associated with features that are visible to an end user. A single user
story might involve calls to several views, potentially spread across
different Django apps. Because of this, I don't think it's appropriate
for an acceptance test to live within a single Django app's directory.</p>
<h3>Not a Unit Test</h3>
<p>On the other hand, our existing tests are also not proper unit tests.
They hit the (test) database and the filesystem, and they currently
don't do any mocking out of expensive or complicated function calls. As
a result, they are slow to run, and will only get slower as we ramp up
our feature set and our test coverage. This is a cardinal sin for unit
tests, and it discourages developers from running the tests frequently
enough. In addition, tests like this often require extensive setup of
test data, and are therefore hard to write, so it's very
labour-intensive to provide adequate test coverage.</p>
<h3>My Solution</h3>
<p><strong>1) I've created a top-level acceptancetests directory.</strong> Most of our
current tests will be moved into this directory, because they are closer
to acceptance tests than unit tests, and will gradually be modified to
be more end-to-end.</p>
<p>These acceptance tests need to be run by the Django testrunner, since
they rely on lots of things that it does, such as creating the test
database and rolling back after each test method. However, the Django
testrunner won't find these tests unless I make 'acceptancetests' a new
Django application, and import all acceptance test classes into its
tests.py. I'm considering doing this, but for the moment I have another
solution, which I'll describe in a moment.</p>
<p>We also need to be able to create unit tests for all of our code,
regardless of whether that code is within a Django model, or somewhere
else in a Django app, or in another top-level directory that isn't a
Django app. Such unit tests should live in a 'tests' package right next
to the code they test. I'm puzzled as to why Django's testrunner doesn't
look for unit tests throughout the project and just run them all, along
with the Django-specific tests.</p>
<p><strong>2) My solution to this is to augment the Django test runner</strong>, by
inheriting from it. My test runner, instead of just looking for tests in
each app's models.py and tests.py, looks for subclasses of
unittest.TestCase in every module throughout the whole project. Setting
Django's settings.TEST_RUNNER causes this custom test runner to be used
by 'manage.py test'. Thanks to the Django contributors for this
flexibility!</p>
<p>So the new test runner finds and runs all the tests which the default
Django runner runs, and it also finds our unit tests from all over the
project, and it also includes our new top-level 'acceptancetests'
directory. This is great!</p>
<p>One surprise is that the number of tests which get run has actually
decreased. On closer inspection, this is because the standard Django
test runner includes all the tests for every Django app, and this
includes not just my project's apps, but also the built-in and
middleware Django apps. We are no longer running these tests. Is this
important? I'm not sure: After all, we are not modifying the code in
django.contrib, so I don't expect these tests to start failing. On the
other hand, maybe those tests help to demonstrate that our Django
settings are not broken?</p>
<h3>An appeal for sanity</h3>
<p>My solutions seem to work, but I'm suspicious that I'm swimming against
the current, because I haven't found much discussion about these issues,
so maybe I'm just well off the beaten path. Have many other people
already written a similar extension to Django's test runner? If so,
where are they all? If not, why not? How else is everyone running their
Django project tests in locations other than models.py or tests.py? Or
do they not have tests outside these locations? If not, why not? I'd
love to hear about it if I'm doing it wrong, or if there's an easier
approach.</p>
<p><strong>Update:</strong> My <a href="http://rangespan.com/">fabulous employer</a> has given
permission to release the test runner as open source:</p>
<p><a href="https://github.com/rangespan/django-alltestsrunner">https://github.com/rangespan/django-alltestsrunner</a></p>
<p><strong>Update2:</strong> I like this post's numeric ID (check the URL)</p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/and-e-keys-in-windows-on-a-us-laptop-keyboard-done-right/" class="u-url">Â£ key in Windows on a US laptop keyboard, done right.</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/and-e-keys-in-windows-on-a-us-laptop-keyboard-done-right/" rel="bookmark">
            <time class="published dt-published" datetime="2011-07-10T13:06:34-05:00" itemprop="datePublished" title="2011-07-10 13:06">2011-07-10 13:06</time></a>
            </p>
                <p class="commentline">            <a href="posts/and-e-keys-in-windows-on-a-us-laptop-keyboard-done-right/#disqus_thread" data-disqus-identifier="cache/posts/and-e-keys-in-windows-on-a-us-laptop-keyboard-done-right.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>The usual solution to typing non-US characters on a US keyboard in
Windows is to hold left-alt, then type on the numeric keypad:</p>
<p>Â£Â Â  Left-alt + 0163</p>
<p>â‚¬Â Â  Left-alt + 0128</p>
<p>This is a pain on my (otherwise fabulous) Thinkpad laptop, because the
numeric keypad is accessed by holding the blue 'Fn' key while you tap
ScrLk, to toggle numeric keypad mode, and then doing the same again
afterwards to turn it off.</p>
<p>One inadequate alternative (on WindowsXP, YMMV) is to go into control
panel; Regional and Language Options; Languages; Details; Settings. Add
a new keyboard configuration, "United States-International", which
should be grouped under your existing language ("English (United
Kingdom)" for me.) OK all the dialogs, restart your applications.</p>
<p>Now you can simply type:</p>
<p>Â£Â Â  Right-alt + Shift + 4</p>
<p>â‚¬Â Â  Right-alt + 5</p>
<p>The downside of this solution is that the "UnitedStates-International"
keyboard setting adds a bunch of other features, including 'dead-keys',
whereby quotes and other punctuation are used to add accents to letters,
which is overly intrusive if, like me, you hardly ever use accents.</p>
<p>Ultimate solution then, define your own personal keyboard layout.
Download the Microsoft Keyboard Layout Creator from here:
<a href="http://msdn.microsoft.com/en-us/goglobal/bb964665">http://msdn.microsoft.com/en-us/goglobal/bb964665</a>.</p>
<p>My end result is an MSI with which I can install a new keyboard layout,
which is exactly like 'US', but with the addition of Â£ on the key
right-alt + 3:</p>
<p><a href="files/2011/07/windows-US-keyboard-layout-with-pound-on-right-alt-3.zip">windows-US-keyboard-layout-with-pound-on-right-alt-3</a></p>
<p>The source .klc file is in there, so you could add your own tweaks on
top of that.</p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/well-parallelise-your-long-running-test-suite-on-ec2/" class="u-url">We'll parallelise your long-running test suite on EC2</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/well-parallelise-your-long-running-test-suite-on-ec2/" rel="bookmark">
            <time class="published dt-published" datetime="2011-04-01T19:04:09-05:00" itemprop="datePublished" title="2011-04-01 19:04">2011-04-01 19:04</time></a>
            </p>
                <p class="commentline">            <a href="posts/well-parallelise-your-long-running-test-suite-on-ec2/#disqus_thread" data-disqus-identifier="cache/posts/well-parallelise-your-long-running-test-suite-on-ec2.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>Another brainstorming project idea:</p>
<p>Some projects have a suite of tests which take a long time to run. This
hinders agility.</p>
<p>We could run these tests suites for clients across EC2 instances. We've
had great success at Resolver Systems in slicing a test run across
several machines and then recombining the results. No doubt some people
have similar solutions. In taking the hassle of configuring these
machines out of your hands, we could divide the test suite execution
time to a fraction of that taken running them in serial on a single
machine.</p>
<p>Additionally, we could run tests against multiple versions of Python, or
run acceptance / system tests, on multiple browsers. These can all be
run in parallel across as many instances as it takes.</p>
<p>The downside of this idea is that unit tests run very quickly, so we
provide no value there. Only for long-running acceptance tests is this a
useful service - and those are tricky because they so often require so
much custom configuration and resources in order to run. Also, like our
own acceptance tests, they may be running on Windows clients, which is a
more expensive VM to run on EC2.</p>
<p>I don't <em>think</em> it could be made to work with an arbitrary set of
projects' tests - the differences between how each project writes and
runs their tests are just too great. But we could provide a sort of
'snakebite light' - an available bunch of servers with a variety of
Python and browser versions which people could write tests to run
against.</p>
<p>Do many people have long-running acceptance tests suites that would run
on a cheap Linux-based VM? How comfortable would people be outsourcing
this sort of service which is so fundamental to your project? Do you
think we'd be overwhelmed by the difficulties inherent in custom
configuration each project would need to run their tests? Again, if you
love or hate this idea, I'd love to hear about it.</p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/your-python-our-servers-what-could-possibly-go-wrong/" class="u-url">Your Python, Our Servers : What could possibly go wrong?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/your-python-our-servers-what-could-possibly-go-wrong/" rel="bookmark">
            <time class="published dt-published" datetime="2011-04-01T17:33:46-05:00" itemprop="datePublished" title="2011-04-01 17:33">2011-04-01 17:33</time></a>
            </p>
                <p class="commentline">            <a href="posts/your-python-our-servers-what-could-possibly-go-wrong/#disqus_thread" data-disqus-identifier="cache/posts/your-python-our-servers-what-could-possibly-go-wrong.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>We've been brainstorming for products to build. What do you think of
this one?</p>
<p><strong>Python Interactive Console in the Browser</strong></p>
<p>One idea is a CPython interactive console in the browser. Client is
Javascript, which sends the user's Python to execute in a sandbox on our
EC2 instances. Dirigible already has the infrastructure to support
running our user's arbitrary Python in a sandbox across our grid - so
we'd only need to strip the spreadsheet-UI off to expose this
functionality to end-users.</p>
<p><a href="files/2011/04/python-in-browser.png"><img alt="Python in the browser" src="files/2011/04/python-in-browser.png" title="Python in the browser"></a></p>
<p>Your console state is persistant - so you could start some
investigation, or a long-running statement, then log off, and then
reconnect to it later from another machine.</p>
<p>Since the Python runs on our servers, all the client needs is a working
browser with Javascript. You could run code from any device - even funky
things like iPads which don't traditionally make installing and running
Python very easy. Your only hinderance would be the keyboard. Since our
servers could be beefy, it would run substantially faster. We could help
to support running in parallel across several servers.</p>
<p>We could provide multiple versions of Python - and keep them fully
loaded with packages from PyPI - so you could use any combo without
having to install anything locally.</p>
<p>There are already <a href="http://www.trypython.org" title="trypython">some</a>
<a href="http://runroot.com/" title="runroot">examples</a>
<a href="http://shell.appspot.com" title="AppEngine shell">of</a>
<a href="http://www.datamech.com/devan/trypython/trypython.py" title="datamech">in-browser</a>
<a href="http://www.skulpt.org/" title="skulpt">Python</a> consoles like this, but none
of them quite do what we'd hope to do.</p>
<p>We're also thinking of providing really simple tools so you could work
on scripts or programs locally, and then run them in the cloud with a
single command / button.</p>
<p>Generally we're thinking of running your stuff on our own EC2 servers.
Other applications might involve executing stuff on your own servers,
instead of ours, but thus far we haven't come up with applications of
this that offer much over fabric or a combination of an SSH session and
Unix program 'screen'.</p>
<p>Would you use this? What for? Do you think it's totally dumb? I'd love
to hear about it.</p>
<p><em>Most</em> interestingly, would you pay for it? We're thinking free for
trivial uses, a few dollars for some advanced features (access to
networking, persistance) and scale up to support teraflop computing.</p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/launch-gitk-displaying-all-extant-branches/" class="u-url">Launch Gitk displaying all branches</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/launch-gitk-displaying-all-extant-branches/" rel="bookmark">
            <time class="published dt-published" datetime="2010-12-31T12:25:31-06:00" itemprop="datePublished" title="2010-12-31 12:25">2010-12-31 12:25</time></a>
            </p>
                <p class="commentline">            <a href="posts/launch-gitk-displaying-all-extant-branches/#disqus_thread" data-disqus-identifier="cache/posts/launch-gitk-displaying-all-extant-branches.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p><strong>Update:</strong> All of the below is made totally redundant by simply using
<code>gitk --all</code>. Thanks Russel!</p>
<hr>
<p>When I launch Gitk, it just displays the current branch. To display
other branches, you must name them on the command line. To display all
existing branches, you need to find out all the branch names:</p>
<pre class="code literal-block"><span></span><code>$ git branch
  create-sql-dev
  formula-rewrite
* master
</code></pre>

<p>Then laboriously type them in to the gitk command line:</p>
<pre class="code literal-block"><span></span><code>$ gitk create-sql-dev formula-rewrite master
</code></pre>

<p>Alternatively, save this Bash snippet in a script on your PATH. I call
mine gitka, for 'all branches':</p>
<pre class="code literal-block"><span></span><code><span class="ch">#!/usr/bin/bash</span>
<span class="c1"># run gitk, displaying all existing branches</span>
<span class="k">for</span> b <span class="k">in</span> <span class="s2">"`git branch`"</span><span class="p">;</span> <span class="k">do</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$b</span><span class="s2">"</span><span class="p">;</span> <span class="k">done</span> <span class="p">|</span> tr -d <span class="s2">"*"</span> <span class="p">|</span> xargs gitk
</code></pre>

<p><img alt="Gitk displaying all branches, not just the current ('master' in bold)" src="files/2010/12/gitk-all-branches.png" title="gitk-all-branches"></p>
<p>This works on Windows too, if you save it as 'gitka.sh', and have Cygwin
installed and associate the .sh filename extension with the Cygwin Bash
executable. You can then run it as 'gitka' from a Windows command prompt
thingy. If you then use 'ln -s gitka.sh gitka', then you can also run it
as just 'gitka' from a Cygwin bash prompt too - without this you would
have had to type out the full 'gitka.sh'.</p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/go-to-definition-in-vim-for-python-using-ctags-on-windows/" class="u-url">'Go to Definition' in Vim for Python using Ctags, Done Right</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/go-to-definition-in-vim-for-python-using-ctags-on-windows/" rel="bookmark">
            <time class="published dt-published" datetime="2010-12-16T20:39:01-06:00" itemprop="datePublished" title="2010-12-16 20:39">2010-12-16 20:39</time></a>
            </p>
                <p class="commentline">            <a href="posts/go-to-definition-in-vim-for-python-using-ctags-on-windows/#disqus_thread" data-disqus-identifier="cache/posts/go-to-definition-in-vim-for-python-using-ctags-on-windows.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>How to set up and configure Vim to use tags for Python development so
that it doesn't suck.</p>
<h3>Install Ctags</h3>
<p>Get the latest version of <a href="http://ctags.sourceforge.net/">ctags</a>, put it
on your PATH. Recent releases are much improved for Python.</p>
<h3>Creating or updating tags files</h3>
<p>You'll probably want one tags file at the root of your project, which
will need to be created or updated whenever you make significant
changes. Either get used to manually running the following command a
lot:</p>
<pre class="code literal-block">ctags -R .
</pre>
<p>or bind it to a key in your \~/.vimrc:</p>
<pre class="code literal-block">map  :<span class="p">!</span><span class="k">start</span> /min ctags <span class="p">-</span>R .
</pre>
<p>I like to set Vim's current working directory equal to the root of
whatever project I'm working in, so now I can press f12 to update the
tags file for the project. The 'start /min' part is a Windows-specific
way to run the command in the background, so Vim isn't locked up waiting
for it to finish.</p>
<h3>Test it out</h3>
<p>Now, in Vim, ctrl-] will jump to the definition of the symbol under
your text cursor. Hooray, etc. If there is more than one definition of
that symbol, it presents a menu for you to choose from.</p>
<h3>Turn off useless tags</h3>
<p>By default, ctags generates tags for Python functions, classes, class
members, variables and imports. The last two are useless to me, and they
actually make ctrl-] more inconvenient, because they increase the
likelyhood of finding duplicate definitions of a tag, causing the menu
to inconveniently pop up, rather than just jumping to the tag you want.</p>
<p>To fix this, create a \~/.ctags file:</p>
<pre class="code literal-block">--python-kinds<span class="o">=</span>-iv
--exclude<span class="o">=</span>build
--exclude<span class="o">=</span>dist
</pre>
<p>The first line turns off tags generation for variables and imports. The
second and third lines turn off generation of tags in the named dirs,
since you almost certainly want to ignore source code in those
directories.</p>
<h3>Case insensitive tag matching</h3>
<p>If your .vimrc requests case-insensitive searching by setting
<em>ignorecase</em> (aka <em>ic</em>), then the above tag matching will also be case
insensitive. This is irksome, because searching for the definition of
property <em>.matrix</em> will present you with a menu asking you to choose
between property <em>.matrix</em> and class <em>Matrix</em>, rather than just jumping
to the property.</p>
<p>To fix this, add this to your .vimrc:</p>
<pre class="code literal-block"><span class="c">" go to defn of tag under the cursor</span>
<span class="k">fun</span><span class="p">!</span> MatchCaseTag<span class="p">()</span>
    <span class="k">let</span> <span class="nb">ic</span> <span class="p">=</span> &amp;<span class="nb">ic</span>
    <span class="k">set</span> <span class="nb">noic</span>
    <span class="k">try</span>
        exe <span class="s1">'tjump '</span> . expand<span class="p">(</span><span class="s1">''</span><span class="p">)</span>
    <span class="k">finally</span>
       <span class="k">let</span> &amp;<span class="nb">ic</span> <span class="p">=</span> <span class="nb">ic</span>
    <span class="k">endtry</span>
<span class="k">endfun</span>
<span class="nb">nnoremap</span>   :<span class="k">call</span> MatchCaseTag<span class="p">()</span>
</pre>
<p><strong>Update:</strong>This Vim script was suggested in a comment by James Vega, in
order to reliably restore the state of 'ignorecase' after doing the tag
jump. Many thanks!</p>
<p>This maps your ctrl-] key to turn off case-insensitivity while it does
the jump to tag, then turn it back on again. Now pressing ctrl-] will
jump directly to your property, only presenting menus on the occasion
when the tag you search for is defined in more than one place using
precisely the same name.</p>
<p>Much better.</p>
<p><strong>Update:</strong> Also see this post about adding stdlib and venv contents to
your tags:
<a href="https://www.fusionbox.com/blog/detail/navigating-your-django-project-with-vim-and-ctags/590/">https://www.fusionbox.com/blog/detail/navigating-your-django-project-with-vim-and-ctags/590/</a></p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/a-guide-to-git-using-spatial-analogies/" class="u-url">A Guide to GIT using spatial analogies</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/a-guide-to-git-using-spatial-analogies/" rel="bookmark">
            <time class="published dt-published" datetime="2010-12-15T14:40:14-06:00" itemprop="datePublished" title="2010-12-15 14:40">2010-12-15 14:40</time></a>
            </p>
                <p class="commentline">            <a href="posts/a-guide-to-git-using-spatial-analogies/#disqus_thread" data-disqus-identifier="cache/posts/a-guide-to-git-using-spatial-analogies.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>Some developers find Git takes a little getting used to, claiming that
it is conceptually convoluted compared to other distributed version
control systems. I used to number myself amongst them.</p>
<p>Happily, I've found that a couple of simple spatial analogies have made
me proficient and fluent in using Git's command-line interface.</p>
<p>One of the things that tripped me up as a novice user was the way Git
handles <strong>branches</strong>. Unlike more primitive version control systems, git
repositories are not linear, they support branching, and are thus best
visualised as trees, upon the nodes of which your current commit may add
new leaf nodes. To visualise this, it's simplest to think of the state
of your repository as a point in a high-dimensional 'code-space', in
which branches are represented as n-dimensional membranes, mapping the
spatial loci of successive commits onto the projected manifold of each
cloned repository.</p>
<p><img alt="Branches as n-branes" src="files/2010/12/I1546manifold.png" title="I1546manifold"></p>
<p><strong>Update:</strong> There is, of course, a <a href="http://www.reddit.com/r/programming/comments/embdf/git_complicated_of_course_not_commits_map_to/">fabulously insightful
commentary</a>
on reddit.</p>
<p><strong>Update:</strong> Thanks folks. You've made my usual one or two hundred daily
visitors look kinda paltry:</p>
<p><img alt="spike in daily traffic graph" src="files/2010/12/daily-traffic.png" title="daily-traffic"></p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/converting-any-repository-fom-svn-to-hg-on-windows/" class="u-url">Converting any repository from Svn to Hg on Windows</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/converting-any-repository-fom-svn-to-hg-on-windows/" rel="bookmark">
            <time class="published dt-published" datetime="2010-10-20T10:26:02-05:00" itemprop="datePublished" title="2010-10-20 10:26">2010-10-20 10:26</time></a>
            </p>
                <p class="commentline">            <a href="posts/converting-any-repository-fom-svn-to-hg-on-windows/#disqus_thread" data-disqus-identifier="cache/posts/converting-any-repository-fom-svn-to-hg-on-windows.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>There's been a lot of
<a href="http://www.voidspace.org.uk/python/weblog/index.shtml">blather</a> of late
about this supposedly-fiddly conversion process. Personally I've found
that working on the Windows operating system, the transition is a lot
smoother. Simply first install Cygwin, cd to the root of your
repository, and then:</p>
<pre class="code literal-block"><span></span><code>find . -name .svn -exec rm -fr <span class="o">{}</span> <span class="se">\;</span>
hg init
hg add .
</code></pre>

<p>and you're done. There may be a few <em>nuances</em> this doesn't address, but
come on, let's not expect miracles.</p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/rerun-unit-tests-whenever-files-update/" class="u-url">Rerun unit tests whenever files update</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/rerun-unit-tests-whenever-files-update/" rel="bookmark">
            <time class="published dt-published" datetime="2010-10-15T01:43:33-05:00" itemprop="datePublished" title="2010-10-15 01:43">2010-10-15 01:43</time></a>
            </p>
                <p class="commentline">            <a href="posts/rerun-unit-tests-whenever-files-update/#disqus_thread" data-disqus-identifier="cache/posts/rerun-unit-tests-whenever-files-update.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p><em>In which I once again indulge my obscure command-line fetish.</em></p>
<p>I often spend hours of my day cycling through:</p>
<ul>
<li>Edit code and its unit tests</li>
<li>Save my changes</li>
<li>Push a button or change window focus to explicitly re-run the code's
    unit tests.</li>
</ul>
<p>Oh frabjous day, the grinding manual labour of the last of these three
steps can now be banished forever, courtesy of <code>rerun</code>, a command line
Python script that re-runs a given command whenever it detects changes
to any of the files in the current directory, or its subdirectories.</p>
<p><strong>Update</strong>: It's Python 2.7, and works great on Windows XP, Macs and
Ubuntu.</p>
<p>For example: I had previously bound f6 in Vim to 'run the current file's
unit tests. Now I've bound shift-f6 to <code>rerun</code> the current file's
unit tests in a new console window. This pops up a new window showing
the test results. I then continue editing in Vim, and whenever I hit
save, the unit tests are re-run in the other window. All the while the
focus stays on my editor. It's really sweet!</p>
<p>Thanks for the original idea goes to to the bash command <code>watch</code>, and an
old (now offline) blog post by Jeff Winkler.</p>
<p><a href="https://bitbucket.org/tartley/rerun">https://bitbucket.org/tartley/rerun</a></p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/flying-high-opengl-from-python-part-2/" class="u-url">Flying High: OpenGL from Python, Part 2</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/flying-high-opengl-from-python-part-2/" rel="bookmark">
            <time class="published dt-published" datetime="2010-08-03T10:04:43-05:00" itemprop="datePublished" title="2010-08-03 10:04">2010-08-03 10:04</time></a>
            </p>
                <p class="commentline">            <a href="posts/flying-high-opengl-from-python-part-2/#disqus_thread" data-disqus-identifier="cache/posts/flying-high-opengl-from-python-part-2.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p><em>This is second in a series of articles about algorithmically generating
geometry to drive OpenGL from Python.</em></p>
<p><a href="posts/flying-high-hobbyist-opengl-from-python"><em>&lt;&lt; Back to part 1</em></a></p>
<p><em>Last time we got as far as creating some instances of our super-simple
Shape class, and having Glyph and Render classes convert those to arrays
for OpenGL and render them. This time, we start using that
infrastructure to create some more interesting geometries, which means
there's less code, and more pretty pictures.</em></p>
<hr>
<h3><strong>Composite Shapes</strong></h3>
<p>In order to create more complex shapes by composing instances of
existing ones, we need a simple composite shape:</p>
<pre class="code literal-block"><span class="k">class</span> <span class="nc">MultiShape</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matrices</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matrices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Matrix</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">orientation</span><span class="p">))</span>
</pre>
<p>A MultiShape contains a list of child Shapes, and a matrix for each
child, indicating the child's position and orientation relative to the
MultiShape's front-and-center.</p>
<p>This is probably as good a point as any to confess that for the purposes
of this demo, I ended up writing my own Matrix class, along with my own
Orientation class. Even my Vec3, which earlier I showed you defined as a
named tuple, gradually started to sprout some methods, until it became a
fully-formed custom vector class. This was pretty silly - it easily
doubled the size of my code-base, and while it felt like rewarding and
productive work, it was actually a waste of time. With hindsight, I
should have predicted this would happen, and started out using an
existing library for things like this, such as Euclid or Numpy. Way it
goes.</p>
<p>Anyhow, if a Multishape is going to be usable wherever a Shape is
currently used, it needs to provide the same interface, which luckily is
very simple - it just needs to provide iterables of vertices, faces and
face_colors. Here is how MultiShape provides a sequence of vertices, by
chaining the vertices of all its children, each vertex transformed by
the matrix of the relevant child shape:</p>
<pre class="code literal-block"><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">vertices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">matrix</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">vertex</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">child</span><span class="p">,</span> <span class="n">matrix</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">matrices</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">vertices</span>
    <span class="p">)</span>
</pre>
<p>There is an inefficiency to this. When MultiShapes are nested, I'm
transforming each vertex once for every branch in the tree. It would be
cheaper to just multiply the matrices of nested MultiShapes, and then
have the top-level MultiShape apply the resulting transforms to the
vertices of each of its children. However, we're only performing this
work at application start-up, not every frame, so I'm choosing to eat it
for the sake of simple-as-possible code.</p>
<p>Similar properties are defined on MultiShape to provide sequences of
face indices and face_colors, by aggregating those of its children.</p>
<p>Using MultiShape, we can now easily compose groups of our basic Shapes.
A new factory function composes a bunch of cubes into the same
MultiShape:</p>
<pre class="code literal-block"><span class="k">def</span> <span class="nf">CubeCorners</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="n">color1</span><span class="p">,</span> <span class="n">color2</span><span class="p">):</span>
    <span class="n">multi</span> <span class="o">=</span> <span class="n">MultiShape</span><span class="p">()</span>
    <span class="n">multi</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="n">Cube</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="n">repeat</span><span class="p">(</span><span class="n">color1</span><span class="p">)),</span>
        <span class="n">position</span><span class="o">=</span><span class="n">Origin</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">repeat</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">))):</span>
        <span class="n">multi</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="n">Cube</span><span class="p">(</span><span class="n">edge</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">repeat</span><span class="p">(</span><span class="n">color2</span><span class="p">)),</span>
            <span class="n">position</span><span class="o">=</span><span class="n">Vec3</span><span class="p">(</span><span class="o">*</span><span class="n">pos</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">edge</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">multi</span>
</pre>
<p><img alt="A cluster of cubes, rendered in one glDrawElements call" src="files/2010/07/screen-cube-cluster2.png" title="A cluster of cubes, rendered in one glDrawElements call"></p>
<p>Another new factory function, <em>RingOf:</em></p>
<pre class="code literal-block"><span class="k">def</span> <span class="nf">RingOf</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
    <span class="n">multi</span> <span class="o">=</span> <span class="n">MultiShape</span><span class="p">()</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">orientation</span> <span class="o">=</span> <span class="n">Orientation</span><span class="p">()</span>
    <span class="n">delta_angle</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">/</span> <span class="n">number</span>
    <span class="k">while</span> <span class="n">angle</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span><span class="p">:</span>
        <span class="n">angle</span> <span class="o">+=</span> <span class="n">delta_angle</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">Vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span>
        <span class="n">orientation</span><span class="o">.</span><span class="n">pitch</span><span class="p">(</span><span class="n">delta_angle</span><span class="p">)</span>
        <span class="n">multi</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">orientation</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">multi</span>
</pre>
<p>returns copies of a given child shape, arranged in a ring, such as this
ring of cubes:</p>
<p><img alt="A ring of cubes" src="files/2010/07/screen-ring1.png"></p>
<p>A ring of truncated cubes:</p>
<p><img alt="A ring of truncated cubes" src="files/2010/07/screen-ring2.png"></p>
<p>A ring of interpenetrated tetrahedrons:</p>
<p><img alt="A ring of interpenetrated tetrahedrons" src="files/2010/07/screen-ring3.png"></p>
<p>This is just starting to look a bit like a thorny geometric mushie trip, which
in this context I'm counting as a success.</p>
<p>If we can compose basic shapes into rings, we can also compose rings
into... um... <em>tri-axis-rings</em>:</p>
<pre class="code literal-block"><span class="k">def</span> <span class="nf">TriRing</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
    <span class="n">multi</span> <span class="o">=</span> <span class="n">MultiShape</span><span class="p">()</span>
    <span class="n">ring</span> <span class="o">=</span> <span class="n">RingOf</span><span class="p">(</span><span class="n">Cube</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="n">colors</span><span class="p">),</span> <span class="n">radius</span><span class="p">,</span> <span class="n">number</span><span class="p">)</span>
    <span class="n">multi</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ring</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="n">Orientation</span><span class="p">(</span><span class="n">XAxis</span><span class="p">))</span>
    <span class="n">multi</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ring</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="n">Orientation</span><span class="p">(</span><span class="n">YAxis</span><span class="p">))</span>
    <span class="n">multi</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ring</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="n">Orientation</span><span class="p">(</span><span class="n">ZAxis</span><span class="p">,</span> <span class="n">XAxis</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">multi</span>
</pre>
<p>If you look carefully, you can make out some depth-buffer fighting where the
three rings intersect, but I'm moving too fast to worry about that now.</p>
<p><img alt="Tri-axis rings" src="files/2010/07/screen-tri-ring.png"></p>
<p>Because we're drawing each MultiShape using a single iteration of the
Render.draw() loop, we've massively reduced the overhead in drawing each
Shape, so we can easily add all of these at once into the world at
60fps, although it does form a bit of a visual cacophony:</p>
<p><img alt="All the rings, plus some other stuff" src="files/2010/07/screen-all-rings-etc.png"></p>
<p>I wonder how much stuff we can add into a MultiShape before it starts to
affect the framerate? Let's investigate... How about a spherical glob of
red blood cubes:</p>
<p><img alt="A glob of red blood cubes" src="files/2010/08/screen-glob-red-cubes2.png"></p>
<p>It turns out I can get about 14,000 cubes (168,000 triangles)
<a href="posts/flying-high-opengl-from-python-part-2/#update">[1]</a> into a single MultiShape like this before the framerate
starts to drop. I'm still rendering these as regular ctypes arrays, not
OpenGL vertex buffers (I don't think my hardware supports that), so all
the geometry is being sent needlessly over the bus to the GPU every
frame.</p>
<p>How about an alternative, the RgbCubeCluster:</p>
<pre class="code literal-block"><span class="k">def</span> <span class="nf">RgbCubeCluster</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="n">cluster_edge</span><span class="p">,</span> <span class="n">cube_count</span><span class="p">):</span>
    <span class="n">cluster</span> <span class="o">=</span> <span class="n">MultiShape</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">cube_count</span><span class="p">):</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="n">Random</span><span class="p">()</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">Vec3</span><span class="p">(</span>
            <span class="n">color</span><span class="o">.</span><span class="n">r</span> <span class="o">-</span> <span class="mi">128</span><span class="p">,</span>
            <span class="n">color</span><span class="o">.</span><span class="n">g</span> <span class="o">-</span> <span class="mi">128</span><span class="p">,</span>
            <span class="n">color</span><span class="o">.</span><span class="n">b</span> <span class="o">-</span> <span class="mi">128</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">cluster_edge</span> <span class="o">/</span> <span class="mi">256</span><span class="p">)</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="n">shape</span><span class="o">=</span><span class="n">Cube</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="n">repeat</span><span class="p">(</span><span class="n">color</span><span class="p">)),</span>
            <span class="n">position</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">cluster</span>
</pre>
<p>This creates a cluster of cubes, each one colored by its position in RGB
space.</p>
<p><img alt="An RGB cube cluster" src="files/2010/07/screen-rgb-cluster.png"></p>
<p>We still have enough <em>oomph</em> left over to dive the camera right into the
midst of the RgbCubeCluster and reveal that all the previous stuff is
still in the world too:</p>
<p><img alt="Whirling machinery at the center of an RgbCluster" src="files/2010/08/screen-rgbcluster-and-everything.png"></p>
<h3><strong>Recursively Generated Geometry</strong></h3>
<p>Can we make any more interesting recursively-defined geometry? The first
thing I thought of (no doubt this has been done many times before) was
the 3D equivalent of a <a href="http://en.wikipedia.org/wiki/Koch_curve">Koch curve</a>:
Take a tetrahedron, and for each face, embed a new, smaller tetrahedron
sticking out of it. Recursively repeat this for each of the new smaller
triangles that have been formed.</p>
<p>The first time I coded this, successive iterations literally replaced
every new surface triangle that was formed by the process, with an
arbitrary break after eight or so iterations. I was quite surprised by
the result, which turned out to look like a slightly corrugated cube. At
first I naturally assumed that a bug in my code was the cause, but after
a period of contemplation, I realised this was the correct geometric
result. The reason for it can be seen in this Wikimedia diagram of the
first three iterations of forming a Koch surface:</p>
<p><img alt="" src="files/2010/08/Koch_surface_0_through_3.png"></p>
<p>The first iteration replaces every triangle by sticking a new
tetrahedron out of it - exactly as I had done for every face of my
original. The next iteration sticks smaller tetrahedrons onto every new
surface, and the edges of these new, smaller tetrahedrons all line up
with each other, to form long, contiguous straight seams in the
resulting shape. By the third iteration (the final one shown here) the
end result is becoming apparent. Each successive iteration merely
reduces the size of the ridges - the overall shape of the surface is
unchanged.</p>
<p>I modified my algorithm to only replace the triangular faces of the
newly-formed smaller tetrahedrons, rather than replacing every
triangular surface, and the result is this more pleasing snowflake
shape.</p>
<p><img alt="A Koch tetrahedron" src="files/2010/08/screen-koch-tetra.png"></p>
<p>This algorithm is about 60 lines of code. A similar operation can be
done on a cube, by poking a new, smaller cube out of each of its faces:</p>
<p><img alt="A Koch cube" src="files/2010/08/screen-koch-cube.png"></p>
<p>The deeper red parts are the original cube and the early generations of
children. The lighter yellow parts are the later generations.</p>
<p>The final and best example in this section was supplied by Oscar
Lindberg, who was interested enough on my old blog post about this to
download the code and produce some shapes of his own. Screenshots can't
do it justice, but the full stately geometry becomes wonderfully
apparent when it's in motion. The <em>tetrix</em>, aka the <a href="http://en.wikipedia.org/wiki/Sierpinski_triangle">Sierpinski
tetrahedron</a>:</p>
<p><img alt="The tetrix, aka Siepinski Tetrahedron" src="files/2010/08/screen-sierpinski.png"></p>
<h3><strong>Odds and Ends</strong></h3>
<p>That's about all I've got to show you. Overall I'm really pleased by
this, and excited to do some more of the same going forward.</p>
<p>You may have noticed I've cheated a little in the demo / screenshots -
some of them show clear evidence of the rudimentary lighting shader I
added (e.g. topmost faces are slightly lighter in color than other
faces.) It would be simple enough to fake this, by providing slightly
varying colors for each face of our shapes, but for those of you looking
at the code: I didn't do that. Instead, I had Glyph generate arrays of
surface normals, which is done by Glyph.get_glnormals(), which works
pretty much just like all the other Glyph methods we examined in part 1.
I was getting tired of explaining how Glyph worked, so I figured you
were probably getting tired of it too, and wouldn't mind if I skipped a
little which wasn't strictly necessary.</p>
<p>I was initially a little disappointed by the performance at rendering
many independently positioned and oriented objects, but now it's picked
up (see footnote [1]) and is now perfectly acceptable: a little
over 450 separately moving cubes at 60fps. The OpenGL bindings in
PyOpenGL wisely choose to prefer correctness and robustness over
performance by default, so as a result, calling OpenGL from Python is
not fast out of the box. The <a href="http://pyopengl.sourceforge.net/documentation/">PyOpenGL
documentation</a> suggests
many ways in which this performance can be regained once your program is
working and debugged. I'm not yet using any of these suggestions, so
hopefully my sluggish performance could be improved substantially.</p>
<p>In addition, Richard Jones suggested that the innermost Render.draw()
loop could possibly benefit from <a href="http://www.cython.org/">Cython</a>
(optional static typing to be added to code written in a less-dynamic
subset of Python.) This would not just improve the general performance
of the code in that loop, by actually compiling it to C, but in doing
so, it would eliminate the Python / C boundary performance penalties,
and this is something I'm excited to try out in the near future.</p>
<p>[1] <strong>Update:</strong> A couple of hours after hitting publish on
this, I discover that switching from the PyOpenGL bindings to those
built into pyglet gives me two to four times the frame rate, for zero
code change except the imports. Clearly I don't understand how to get
the best performance out of PyOpenGL. I've been back and updated the
performance stats in this post, and hope to make another post about this
at some point when I understand what I was doing wrong.</p>
<p><em>The demonstrated</em> <em>code</em> <em>is available at
<a href="https://github.com/tartley/gloopy">https://github.com/tartley/gloopy</a></em></p>
</div>
    </div>
    </article>
</div>
        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-21.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-19.html" rel="next">Older posts</a>
            </li>
        </ul></nav><script>var disqus_shortname="tartley";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div>
        <!--End of body content-->

        <footer id="footer"></footer>
</div>
</div>

            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
