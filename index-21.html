<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Creating a website devoted to oneself has been described as the greatest act of hubris. Welcome aboard!">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>tartley.com (old posts, page 21) | tartley.com</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="rss.xml">
<link rel="canonical" href="https://www.tartley.com/index-21.html">
<link rel="icon" href="welcome.gif" sizes="16x16">
<link rel="prev" href="index-22.html" type="text/html">
<link rel="next" href="index-20.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://www.tartley.com/">

                <span id="blog-title">tartley.com</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>
                </li>
<li>
<a href="rss.xml">RSS feed</a>
                </li>
<li>
<a href="pages/about/">About</a>

                
            </li>
</ul>
<!-- DuckDuckGo custom search --><form method="get" id="search" action="https://duckduckgo.com/" class="navbar-form pull-left">
<input type="hidden" name="sites" value="https://tartley.com/"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" name="q" maxlength="255" placeholder="Searchâ€¦" class="span2" style="margin-top: 4px;"><input type="submit" value="DuckDuckGo Search" style="visibility: hidden;">
</form>
<!-- End of custom search -->


            <ul class="nav navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
    
    <a rel="me" href="https://mastodon.social/@tartley"></a>
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/altered-carbon/" class="u-url">Altered Carbon</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/altered-carbon/" rel="bookmark">
            <time class="published dt-published" datetime="2014-02-02T12:59:43-06:00" itemprop="datePublished" title="2014-02-02 12:59">2014-02-02 12:59</time></a>
            </p>
                <p class="commentline">            <a href="posts/altered-carbon/#disqus_thread" data-disqus-identifier="cache/posts/altered-carbon.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p><span style="float: left">
<img alt="Altered Carbon cover" src="files/2014/02/richard-morgan-altered-carbon.jpg"></span></p>
<p><em>by Richard Morgan</em> (2001)</p>
<p>A romp through a hyperviolent cyberpunk future through the eyes of a
character reluctantly press-ganged into the role of detective in a story
woven around personality uploads, swaps, and backups. I did enjoy it,
but was put off by the main character winning their victories
by consecutive applications of remorseless violence. There's no cleverness
or examinations of morality here, just that the character cast as the "goodie"
triumphs by being better at beating people up.</p>
<p>10/10 if you're looking to kick back on the couch with tea, cake, and
some exciting SF.</p>
<p>0/10 if you're not.</p>
<p><br style="clear: both"></p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/domain-driven-design-tackling-complexity-in-the-heart-of-software/" class="u-url">Domain Driven Design: Tackling Complexity in the Heart of Software</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/domain-driven-design-tackling-complexity-in-the-heart-of-software/" rel="bookmark">
            <time class="published dt-published" datetime="2014-01-27T11:05:53-06:00" itemprop="datePublished" title="2014-01-27 11:05">2014-01-27 11:05</time></a>
            </p>
                <p class="commentline">            <a href="posts/domain-driven-design-tackling-complexity-in-the-heart-of-software/#disqus_thread" data-disqus-identifier="cache/posts/domain-driven-design-tackling-complexity-in-the-heart-of-software.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p><span style="float: left">
<img alt="Domain Driven Design cover" src="files/2014/01/domaindrivendesign.jpg"></span></p>
<p><em>by Eric Evans (2004)</em></p>
<p>It's a big, dense book -- possibly the most important of the technical
books I've read in a flurry over the last few months, catching up after
recovering a modicum of sanity in our lives after our kid's first year.
I finish it feeling changed, invigorated, and given new direction.</p>
<p>At its core is a simple idea, which sounds neither new nor revolutionary
on the surface. Software projects, Evans maintains, should work closely
with business experts to create and maintain a domain model. The model
might be expressed as a class diagram of core business concerns, and
should also correspond directly to a body of code modelling these
business entities. This forms a set of core business entities which are
clearly analogous to things like the core enterprise entities of the
hexagonal or clean architectures.</p>
<p>However it's created, the terminology and notation used in the class
diagram (or it's equivalent) should be well understood by individuals on
both side of the tech/business divide. In the past I think I've made the
mistake of believing that only developers needed to understand it, and
therefore the model only needed to be expressed in code.</p>
<p>This model should be displayed prominently, referred to continually, and
in a healthy project should very directly correspond to the specialised
language that evolves within the organisation. Where the team's language
doesn't match the model - for example, your business experts' use of
plurals betrays that the cardinality of relationships are modelled
wrongly, then the model - and the underlying code - should be
aggressively refactored to match reality.</p>
<p>Evans makes a persuasive case that the appropriate management of this
complexity at the heart of your software will be a major influence on
the success of the project. To be fair, this is a viewpoint that I
already believed in, so I was a sucker for all of this. Without an
appropriate approach to these central design concerns, over time
developers will find they are no longer able to understand the code
thoroughly enough to be able to modify or extend it easily, unless they
deliberately or inadvertently use design-breaking hacks like redundancy
or mislocated chunks of code. This forms a vicious cycle of technical
debt accrual, and creates an upper limit on the size or complexity which
can be achieved by any project before productivity begins to slump.
Other metrics like reliability then also suffer.</p>
<p>To counter this, conquering these central design issues requires a
pro-active and multi-pronged effort. Firstly, the existing design must
be understood by all parties. In order for this to remain true, the
design needs to be kept up to date and be easily understood by new team
members. The code must be kept directly in sync with the model, and kept
understandable - inappropriate dependencies must be ruthlessly pruned.
Simultaneously, the "correct" design must be discovered iteratively,
throughout the life of the project, and this can only be done by
encouraging continual conversations between developers and business
folks to discuss the potential inadequacies of the current design and
possible alternatives.</p>
<p>When managed correctly, this lends an agility and suppleness to project.
Developers find it easy to integrate subsequent parts of code because
they 'fit naturally' into the existing design, and when the design is
found wanting, it's relatively easy to modify it to incorporate new
concerns.</p>
<p>There are times when I've struggled to convey the message about how the
resulting trade off works between time spent refactoring versus time
saved over the long term. Evans describes this in an interesting way.
Instead of trying to model team productivity by applying a multiplier to
describe drag caused by technical debt, he simply contrasts the normal
way projects slow down as they become larger and more complex, with a
project that instead <em>speeds up</em> over time, as developers, unhindered by
a cycle of technical debt, are instead empowered by the creation of
powerful and expressive abstractions, which can then be relatively
easily reconfigured into unanticipated configurations.</p>
<p>To counter-balance this idealistic hand-waving, the next section dives
right into some specific design practices which embody these ideas.
These are valuable and insightful, stock-in-trade, such as
distinguishing between entity and value types. But many of the ideas
were completely new to me, such as the concept of <em>aggregates</em>, which
define subsets of the domain model which are always atomically retrieved
from (or updated in) a data store.</p>
<p>In short, I really loved this book. It stretched and inspired me. It's
in a very small set of books I've flagged to re-read in a couple of
years. It's top of my list for 'books to bring in and talk about at
work'.</p>
<p>Rating:</p>
<p>10/10 if you're a programmer, or work with programmers.</p>
<p>0/10 if you're not, or don't.</p>
<p><br style="clear: both"></p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/brief-interviews-with-hideous-men/" class="u-url">Brief Interviews with Hideous Men</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/brief-interviews-with-hideous-men/" rel="bookmark">
            <time class="published dt-published" datetime="2014-01-22T20:51:51-06:00" itemprop="datePublished" title="2014-01-22 20:51">2014-01-22 20:51</time></a>
            </p>
                <p class="commentline">            <a href="posts/brief-interviews-with-hideous-men/#disqus_thread" data-disqus-identifier="cache/posts/brief-interviews-with-hideous-men.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p><span style="float: left; padding: 1em">
<img alt="Brief Interviews With Hideous Men cover" src="files/2014/01/brief-interviews-with-hideous-men.jpg"></span></p>
<p><em>by David Foster Wallace (1999)</em></p>
<p>A collection of creative essays, varying from playful to unflinchingly
uncomfortable, shot through with Wallace's typical humour and
introspection.</p>
<p>I've tended to love and hate his <a href="infinite-jest">other</a>
<a href="everything-and-more">writing</a> in equal measure, but with such
ferocity that I unreservedly place him amongst my very favourite
authors. There wasn't even much for me to hate in this one, relatively
lacking as it is in labyrinthine footnotes.</p>
<p>A couple of the essays left me cold (<em>Tri-Stan: I Sold Sissee Nar to
Ecko</em> springs to mind - presumably I'm missing the point entirely),
but most of them I found thoroughly engaging and
thought provoking. I'm tempted to read up on those that seemed most
challenging to me (<em>Church Not Made With Hands</em>, say), and give them
another try.</p>
<p>It's been a while. Rating:</p>
<p>0/10 if you don't want to delve deeply into sometimes uncomfortable
subjects, such as depression, unconventional sex acts, and rape.</p>
<p>10/10 if you like to be stretched, or at least stirred around, in
interesting directions.</p>
<p><br style="clear: both"></p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/chaining-a-sequence-of-generators/" class="u-url">Chaining a sequence of generators</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/chaining-a-sequence-of-generators/" rel="bookmark">
            <time class="published dt-published" datetime="2013-10-15T15:09:54-05:00" itemprop="datePublished" title="2013-10-15 15:09">2013-10-15 15:09</time></a>
            </p>
                <p class="commentline">            <a href="posts/chaining-a-sequence-of-generators/#disqus_thread" data-disqus-identifier="cache/posts/chaining-a-sequence-of-generators.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>I often gravitate towards solutions using a series of chained
generators, in the style of David Beazley's '<a href="http://www.dabeaz.com/generators-uk/">Generator Tricks for
Systems Programmers</a>.'</p>
<p>This results in the outer level of my code calling one generator after
another, terminating in something that consumes the rows, pulling data
one row at a time through each of the generators:</p>
<pre class="code literal-block"><span class="n">inputRows</span> <span class="o">=</span> <span class="n">read</span><span class="p">()</span>
<span class="n">parsedRows</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">inputRows</span><span class="p">)</span>
<span class="n">processedRows</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="n">parsedRows</span><span class="p">)</span>
<span class="n">outputRows</span> <span class="o">=</span> <span class="n">format_</span><span class="p">(</span><span class="n">processedRows</span><span class="p">)</span>
<span class="n">output</span><span class="p">(</span><span class="n">outputRows</span><span class="p">)</span>
</pre>
<p>where each called function except the last is actually a generator, e.g:</p>
<pre class="code literal-block"><span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
        <span class="k">yield</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</pre>
<p>This is great. But my itch is that the top level code above is a bit
wordy, given that what it does is so simple. The reader has to check
each temporary variable quite carefully to be sure it's doing the right
thing.</p>
<p>Fowler's 'Refactoring' describes circumstances when <a href="http://www.refactoring.com/catalog/replaceTempWithQuery.html">it's good to remove
intermediate
variables</a>,
which results in:</p>
<pre class="code literal-block"><span class="n">output</span><span class="p">(</span> <span class="n">format_</span><span class="p">(</span> <span class="n">process</span><span class="p">(</span> <span class="n">parse</span><span class="p">(</span> <span class="n">read</span><span class="p">()</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
</pre>
<p>This is certainly less wordy, and expresses what's happening very
directly, but it annoys some of my colleagues that the called functions
are listed in reverse order from what one might intuitively expect.</p>
<p>I've had this idea in my head to create a decorator for generators which
allows one to chain them in an intuitive order, possibly using some
unconventional notation such as:</p>
<pre class="code literal-block"><span class="n">read</span><span class="p">()</span> <span class="o">|</span> <span class="n">parse</span> <span class="o">|</span> <span class="n">process</span> <span class="o">|</span> <span class="n">format_</span> <span class="o">|</span> <span class="n">output</span>
</pre>
<p>where 'parse', et al, are now decorated with '@chainable' or somesuch,
which returns an instance of a class that stores the wrapped generator,
and overrides __or__ to do its magic. Maybe 'read' doesn't need to
be invoked manually there at the start of the chain. I haven't really
thought this through.</p>
<p>Luckily, before embarking on that, I realised today I've been
over-complicating the whole thing. There's no need for decorators, nor
for the cute '|' syntax. I just need a plain old function:</p>
<pre class="code literal-block"><span class="k">def</span> <span class="nf">link</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="o">*</span><span class="n">transforms</span><span class="p">):</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">source</span>
    <span class="k">for</span> <span class="n">transform</span> <span class="ow">in</span> <span class="n">transforms</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">args</span>
</pre>
<p><strong>Update</strong>: This code has been improved thanks to suggestions in the
comments from Daniel Pope (eliminate the 'first' variable) and Xtian
(take an iterable rather than a callable for the source.)</p>
<p>This assumes the first item passed to link is an iterable, and each
subsequent item is a generator that takes the result of the item before.</p>
<p>If the final item in the sequence passed to 'link' is a generator, then
this returns a generator which is the composite of all the ones passed
in:</p>
<pre class="code literal-block"><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">link</span><span class="p">(</span><span class="n">read</span><span class="p">(),</span> <span class="n">parse</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span> <span class="n">format_</span><span class="p">):</span>
    <span class="nb">print</span> <span class="n">item</span>
</pre>
<p>Or if the final item passed to 'link' is a regular function, which
consumes the preceding generators, then calling 'link' will invoke the
generators, i.e. the following is the same as the above 'for' loop:</p>
<pre class="code literal-block"><span class="n">link</span><span class="p">(</span><span class="n">read</span><span class="p">(),</span> <span class="n">parse</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span> <span class="n">format_</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
</pre>
<p>There's some rough edges, such as determining what to do if different
generators require other args. Presumably 'partial' could help here. But
in general, 'link' only needs to be written once, and I'm liking it.</p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/revolution-an-instruction-manual/" class="u-url">Revolution: An Instruction Manual</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/revolution-an-instruction-manual/" rel="bookmark">
            <time class="published dt-published" datetime="2013-08-10T11:50:36-05:00" itemprop="datePublished" title="2013-08-10 11:50">2013-08-10 11:50</time></a>
            </p>
                <p class="commentline">            <a href="posts/revolution-an-instruction-manual/#disqus_thread" data-disqus-identifier="cache/posts/revolution-an-instruction-manual.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>When you have a government that operates without limits, who proclaims
the right to arrest, torture and kill anyone, anywhere, with no
warrants, no trial, no due process...</p>
<p>When you have a government that militarizes the police and grants the
armed forces the power to operate with impunity within your own borders
and beyond. A government that views you, the people, as the enemy, and
treats you as such...</p>
<p>When you have a government that lies to you takes you into wars of
aggression, toppling country after country, killing hundreds of
thousands of innocent civilians, and sending your sons and daughters and
your fathers and your brothers home in flag draped coffins, or
disfigured and broken in mind and body, their lives destroyed in wars
that serve only to line the pockets of a unelected cartel of bankers and
corporations...</p>
<p>When you have all of this right in front of you, so blatant, so clear,
you shouldn't have to be convinced that both parties in this political
puppet show are owned and operated by the same interests. You shouldn't
have to be convinced that these overrated corporate popularity contests
that some call elections are distractions that will achieve nothing.
With this understood, you shouldn't have to be convinced that the system
you are living under must be brought to a halt.</p>
<p><a href="http://stormcloudsgathering.com/revolution-an-instruction-manual">Read
on...</a></p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/pip-install-lightspeed-and-bulletproof/" class="u-url">pip install : Lightspeed and Bulletproof</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/pip-install-lightspeed-and-bulletproof/" rel="bookmark">
            <time class="published dt-published" datetime="2013-03-08T09:29:09-06:00" itemprop="datePublished" title="2013-03-08 09:29">2013-03-08 09:29</time></a>
            </p>
                <p class="commentline">            <a href="posts/pip-install-lightspeed-and-bulletproof/#disqus_thread" data-disqus-identifier="cache/posts/pip-install-lightspeed-and-bulletproof.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>I saw a post about <a href="http://www.scottisheyes.com/how-to-fix-slow-pip-install">speeding up the Python packaging command "pip
install"</a>, by
specifying more responsive mirrors for querying and downloading
packages. For my situation, a better tactic is this.</p>
<p>Step one: Download all your project's dependencies into a local
'packages' dir, but don't install them yet:</p>
<pre class="code literal-block"><span></span><code>mkdir packages
pip install --download<span class="o">=</span>packages -r requirements.txt
</code></pre>

<p>Step two, install from the 'packages' dir:</p>
<pre class="code literal-block"><span></span><code>pip install --no-index --find-links<span class="o">=</span>packages -r requirements.txt
</code></pre>

<p><em>(The above syntax works on pip 1.3, released yesterday. Docs for older
versions of pip claim to support this, but in practice, for pip 1.2,
I've had to use "<code>--find-links=file://$PWD/packages</code>")</em></p>
<p>Step 2 works even if PyPI is unreachable. It works even if some of your
dependencies are self-hosted by the authors, and that website is
unreachable. It works even if the version you have pinned of one of your
dependencies has been deleted by the author (some packages do this
routinely after security updates.) It works even if you have no network
connection at all. In short, it makes creation of your virtualenv
bulletproof.</p>
<p>As a nice side effect, it runs really fast, because it isn't downloading
the packages across the internet, nor is it attempting to scan a remote
index to check for matching or newer versions of each package. This is
much quicker than just using a Pip download cache, especially for large
projects with many dependencies which only change occasionally.</p>
<p>At <a href="http://rangespan.com">Rangespan</a>, we check the 'packages' directory
into source control, so that once you've checked out a project's repo,
you have everything you need to deploy locally and run, even if you have
no network. You might choose to treat 'packages' as ephemeral.</p>
<p>It was pointed out to me recently by
<a href="https://twitter.com/jezdez">@jezdez</a>, Pip maintainer, this usage
pattern has now been <a href="http://www.pip-installer.org/en/latest/cookbook.html#fast-local-installs">explicitly called out in the
documentation</a>,
which was substantially reorganised and improved with the recent 1.3
release.</p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/hexagonal-django/" class="u-url">Hexagonal Django</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/hexagonal-django/" rel="bookmark">
            <time class="published dt-published" datetime="2012-12-04T14:42:01-06:00" itemprop="datePublished" title="2012-12-04 14:42">2012-12-04 14:42</time></a>
            </p>
                <p class="commentline">            <a href="posts/hexagonal-django/#disqus_thread" data-disqus-identifier="cache/posts/hexagonal-django.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>The last few weeks I've been thinking about the architectural pattern
known as <a href="http://blog.8thlight.com/uncle-bob/2012/08/13/the-clean-architecture.html">Clean, Onion, Hexagonal, or
Ports'n'Adaptors</a>.
I'm curious if many people are applying it in the Django world.</p>
<p>The premise is for your core application entity classes and business
rules to be plain old objects, with no dependencies. In particular, they
are not dependent on the interfaces between your application and
external systems, such as your persistence mechanism, or your web
framework. Instead, external interface components depend upon your core
business objects. This essentially moves the database from the 'bottom'
layer of the old traditional 'three layer architecture', to form a part
of the topmost layer - a sibling with the 'UI.'</p>
<p>For inbound messages (e.g handling a web request) this is
straightforward - Django calls your view code which calls your business
layer, but keep your business layer separate from your Django code, so
it is stand-alone and unit-testable. For outbound messages, such as then
rendering the web page in response, it's slightly more complicated: Your
business logic must pass the result (typically a pure data structure)
back to your web-aware code, but without your business logic depending
on the web-aware component. This requires an inversion of control.</p>
<p>That way, all your business logic can easily be tested in unit tests,
with no mocking required. You still need some end-to-end tests to verify
integration, but you shouldn't need to involve your UI or database in
testing every detail of your business logic.</p>
<p>Also, you can easily switch out your external system interfaces, such as
persistence, to use another RDBMS, another ORM, a NoSQL store, or an
in-memory version for testing Since the core of your application doesn't
have any dependency on these components, it is oblivious to the
change. The business logic, because it doesn't depend on Django, is no
longer riddled with Django's convenient ORM database access.</p>
<p>Same thing goes for switching out your web framework, or calling the
same logic from web UI or web API calls. And again, for switching out
your UI: add a command line application, or a console UI. The core
application logic is unaffected, and your new interface components
contain only the code that is specific to that interface's concerns.</p>
<p>Another side effect is that your web framework, if you're using one,
becomes a peripheral detail which depends upon your core application,
rather than the other way round. Your Django project would become a
subdirectory of your project, rather than dominating your project
directory structure. Since the business logic formerly contained within
it is now elsewhere (in your core business objects) the Django project
is now very thin. Views, for example, are delegations to single
business-layer functions. The Django project now contains just the
web-oriented aspects of your project, as it should.</p>
<p>These ideas all seem like relatively straightforward software
engineering, and I feel a bit foolish for not having been aware of them
all these years. I console myself that I'm not alone.</p>
<p>UncleBob's Ruby Midwest keynote "<a href="posts/hexagonal-django/%20http:/www.confreaks.com/videos/759-rubymidwest2011-keynote-architecture-the-lost-years">Architecture - The Lost
Years</a>"
attributes one source of this idea to Ivar Jacobsen's 1994 book <a href="posts/hexagonal-django/%20http:/www.amazon.co.uk/Object-oriented-Software-Engineering-Approach-Press/dp/0201544350">Object
Oriented Software Engineering : A Use Case Driven
Approach</a>
(2nd-hand hardbacks cheap on Amazon.)</p>
<p>I see a few people applying these ideas to Rails, but are many people
out there doing this in Django? I plan to refactor a small vertical
slice of our monster Django app into this style, to try and prove the
idea for myself.</p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/encrypted-zip-files-on-osx/" class="u-url">Encrypted zip files on OSX</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/encrypted-zip-files-on-osx/" rel="bookmark">
            <time class="published dt-published" datetime="2012-10-09T10:17:07-05:00" itemprop="datePublished" title="2012-10-09 10:17">2012-10-09 10:17</time></a>
            </p>
                <p class="commentline">            <a href="posts/encrypted-zip-files-on-osx/#disqus_thread" data-disqus-identifier="cache/posts/encrypted-zip-files-on-osx.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p><strong>Update:</strong> I've since switched to KeePassXC, the community fork of KeePassX,
an open source, cross-platorm, local-first, encrypted password storage program.</p>
<hr>
<p>My passwords and other miscellany are in a plain text file within an
encrypted zip. Since starting to use OSX I've been looking for a way to
access my passwords such that:</p>
<ul>
<li>I get prompted for the decryption password.</li>
<li>The file gets unzipped, but not in the same directory, because
    that's synced to Dropbox, so would send my plaintext passwords to
    them every time I accessed them. Maybe to /tmp?</li>
<li>The plaintext file within the zip is opened in \$EDITOR.</li>
<li>Wait for me to close \$EDITOR, then remove my plaintext passwords
    from the filesystem.</li>
<li>Before deleting the passwords, check if I've updated them. If so,
    put the new updated version back into the original zip file.</li>
<li>Don't forget to keep the updated zip file encrypted, using the same
    password as before, without prompting for it again.</li>
</ul>
<p>I failed to find an existing app which would do all this (although I had
no trouble on Linux or even on Windows.) Hence, resorting to good old
Bash:</p>
<pre class="code literal-block"><span class="ch">#!/bin/bash</span>

<span class="nv">ZIPDIR</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/docs/org"</span>

<span class="nb">read</span> -s -p <span class="s2">"Password:"</span> key

<span class="nb">cd</span> <span class="nv">$ZIPDIR</span>
unzip -P <span class="nv">$key</span> passwords.zip passwords.txt -d <span class="nv">$TMPDIR</span>
<span class="k">if</span> <span class="o">[[</span> <span class="nv">$?</span> !<span class="o">=</span> <span class="m">0</span> <span class="o">]]</span> <span class="p">;</span> <span class="k">then</span>
    <span class="nb">exit</span> <span class="m">1</span>
<span class="k">fi</span>

<span class="nb">cd</span> <span class="s2">"</span><span class="nv">$TMPDIR</span><span class="s2">"</span>
touch passwords.datestamp
<span class="nv">$EDITOR</span> passwords.txt
<span class="k">if</span> <span class="o">[[</span> passwords.txt -nt passwords.datestamp <span class="o">]]</span> <span class="p">;</span> <span class="k">then</span>
    zip -P <span class="nv">$key</span> -r <span class="s2">"</span><span class="nv">$ZIPDIR</span><span class="s2">/passwords.zip"</span> passwords.txt
<span class="k">fi</span>

rm passwords.txt
rm passwords.datestamp
</pre>
<p>I don't expect this to be watertight, but seems good enough for today.
I'm happy to hear suggestions.</p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/compiling-macvim-with-python-2-7/" class="u-url">Compiling MacVim with Python 2.7</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/compiling-macvim-with-python-2-7/" rel="bookmark">
            <time class="published dt-published" datetime="2011-10-18T12:25:03-05:00" itemprop="datePublished" title="2011-10-18 12:25">2011-10-18 12:25</time></a>
            </p>
                <p class="commentline">            <a href="posts/compiling-macvim-with-python-2-7/#disqus_thread" data-disqus-identifier="cache/posts/compiling-macvim-with-python-2-7.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>I love the brilliant Vim plugin
<a href="http://www.vim.org/scripts/script.php?script_id=2441">pyflakes-vim</a>,
which highlights errors &amp; warnings, and since I got a MacBook for work,
I've been using MacVim a lot.</p>
<p>This combination has a problem, that MacVim uses the OSX system default
Python 2.6, so pyflakes is unable to handle Python 2.7 syntax, such as
set literals. These are marked as a syntax errors, which prevents the
rest of the file from being parsed.</p>
<p>The solution is to compile your own MacVim, using Python 2.7 instead of
the system Python. The following commands got MacVim compiled for me:</p>
<pre class="code literal-block"><span class="ch">#!/bin/bash</span>
git clone git://github.com/b4winckler/macvim.git
<span class="nb">cd</span> macvim/src
<span class="nb">export</span> <span class="nv">LDFLAGS</span><span class="o">=</span>-L/usr/lib
./configure <span class="se">\</span>
    --with-features<span class="o">=</span>huge <span class="se">\</span>
    --enable-rubyinterp <span class="se">\</span>
    --enable-perlinterp <span class="se">\</span>
    --enable-cscope <span class="se">\</span>
    --enable-pythoninterp <span class="se">\</span>
    --with-python-config-dir<span class="o">=</span>/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/config
make
open MacVim/build/Release
<span class="nb">echo</span> Drag MacVim.app to your Applications directory
</pre>
<p>Without the LDFLAGS setting, I was missing some symbols at link. The
--with-python-config-dir entry came from typing 'which python' to find
where my Python 2.7 install lives, and modifying that result to find its
'config' directory (whatever that is) near to the binary.</p>
<p>As indicated, install by dragging the resulting
macvim/src/MacVim/build/Release/MacVim.app into your Applications
directory.</p>
<p>Open up MacVim, and check out the built-in Python version:</p>
<pre class="code literal-block"><span class="p">:</span><span class="n">python</span> <span class="kn">import</span> <span class="nn">sys</span><span class="p">;</span> <span class="k">print</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span>
<span class="mf">2.7</span><span class="o">.</span><span class="mi">1</span> <span class="p">(</span><span class="n">r271</span><span class="p">:</span><span class="mi">86882</span><span class="n">M</span><span class="p">,</span> <span class="n">Nov</span> <span class="mi">30</span> <span class="mi">2010</span><span class="p">,</span> <span class="mi">10</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">34</span><span class="p">)</span>
</pre>
<p>And files with set literals are now correctly parsed for errors.</p>
<p><strong>Update:</strong> This only works if the Python 2.7 is your default 'python'
executable. Otherwise, or if you get "ImportError: No module named
site"?, see Richard's comments below.</p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/python-2-7-regular-expression-cheatsheet/" class="u-url">Python 2.7 regular expression cheatsheet</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/python-2-7-regular-expression-cheatsheet/" rel="bookmark">
            <time class="published dt-published" datetime="2011-10-14T11:20:11-05:00" itemprop="datePublished" title="2011-10-14 11:20">2011-10-14 11:20</time></a>
            </p>
                <p class="commentline">            <a href="posts/python-2-7-regular-expression-cheatsheet/#disqus_thread" data-disqus-identifier="cache/posts/python-2-7-regular-expression-cheatsheet.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>Couldn't find one of these, so I whipped one up.</p>
<p>Bit of restructured text:</p>
<p><a href="https://github.com/tartley/python-regex-cheatsheet/blob/master/cheatsheet.rst">https://github.com/tartley/python-regex-cheatsheet/blob/master/cheatsheet.rst</a></p>
<p>Install some Python packages:</p>
<p><a href="https://github.com/tartley/python-regex-cheatsheet/blob/master/requirements.txt">https://github.com/tartley/python-regex-cheatsheet/blob/master/requirements.txt</a></p>
<p>Invoke rst2pdf:</p>
<p><a href="https://github.com/tartley/python-regex-cheatsheet/blob/master/Makefile">https://github.com/tartley/python-regex-cheatsheet/blob/master/Makefile</a></p>
<p>Get a nice PDF out:</p>
<p><a href="https://github.com/tartley/python-regex-cheatsheet/releases/download/v0.3.3/cheatsheet.pdf">Python 2.7 regular expression
cheatsheet</a>
(click this link or the image for the most up-to-date PDF from github.)</p>
<p><a href="https://github.com/tartley/python-regex-cheatsheet/releases/download/v0.3.3/cheatsheet.pdf"><img alt="" src="files/2011/10/Python-regular-expression-cheatsheet-0.3.0.png" title="Python regular expression cheatsheet 0.3.3"></a></p>
</div>
    </div>
    </article>
</div>
        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-22.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-20.html" rel="next">Older posts</a>
            </li>
        </ul></nav><script>var disqus_shortname="tartley";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div>
        <!--End of body content-->

        <footer id="footer"></footer>
</div>
</div>

            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
