<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Creating a website devoted to oneself has been described as the greatest act of hubris. Welcome aboard!">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>tartley.com (old posts, page 21) | tartley.com</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="rss.xml">
<link rel="canonical" href="https://www.tartley.com/index-21.html">
<link rel="icon" href="welcome.gif" sizes="16x16">
<link rel="prev" href="index-22.html" type="text/html">
<link rel="next" href="index-20.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://www.tartley.com/">

                <span id="blog-title">tartley.com</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>
                </li>
<li>
<a href="rss.xml">RSS feed</a>
                </li>
<li>
<a href="pages/about/">About</a>

                
            </li>
</ul>
<!-- DuckDuckGo custom search --><form method="get" id="search" action="https://duckduckgo.com/" class="navbar-form pull-left">
<input type="hidden" name="sites" value="https://tartley.com/"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" name="q" maxlength="255" placeholder="Searchâ€¦" class="span2" style="margin-top: 4px;"><input type="submit" value="DuckDuckGo Search" style="visibility: hidden;">
</form>
<!-- End of custom search -->


            <ul class="nav navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
    
    <a rel="me" href="https://mastodon.social/@tartley"></a>
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/thoughts-on-nylas-how-we-deploy-code/" class="u-url">Thoughts on Nylas' "How We Deploy Code"</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/thoughts-on-nylas-how-we-deploy-code/" rel="bookmark">
            <time class="published dt-published" datetime="2015-07-21T19:06:02-05:00" itemprop="datePublished" title="2015-07-21 19:06">2015-07-21 19:06</time></a>
            </p>
                <p class="commentline">            <a href="posts/thoughts-on-nylas-how-we-deploy-code/#disqus_thread" data-disqus-identifier="cache/posts/thoughts-on-nylas-how-we-deploy-code.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>Some thoughts on <a href="https://nylas.com/blog/packaging-deploying-python">Nylas' post "How We Deploy
Code."</a></p>
<p>The goals of making deployment consistent, reliable and fast are very
laudable, and the conclusion involving creating Debian packages is just
great. But in the spirit of geek nitpicking, I can't help but think the
justifications given are misguided, and overlook a simpler solution.</p>
<p><strong>&gt;&gt; pip does not offer a "revert deploy" strategy</strong></p>
<p>Yes it does. Throw away the virtualenv and create a new one using the
requirements.txt from an earlier release. This might be slow, but you
can both speed it up (see below), and you can keep old versioned
virtualenvs around, as a cache of the output of this slow step, so that
reverts (the time when you really want deploys to go quickly) require
only a couple of symlinks.</p>
<p><strong>Update:</strong> Oooh, and I just had an idea. You could version virtualenvs
using a hash of the requirements, so that deploys which do not change
dependencies can share the same virtualenv. I've never tried that - it
might work?!?!</p>
<p><strong>&gt;&gt; Installing dependencies with pip can make deploys painfully
slow</strong></p>
<p>This is true. But it's not the final word on the matter.</p>
<p>Firstly, don't grab the dependencies you're installing from PyPI. Have a
local cache of them. That speeds up the install tremendously, not just
because no download takes place, but also because no trawling of PyPI
and author sites for possible alternate versions takes place. Some
people use a local PyPI instance, but I like simply using a directory
full of packages. Point pip at it using
'<code>pip install --no-index --find-links=packages -r requirements</code>'. The
'packages' directory could be checked into your project's repo, so that
once you've checked a project out, you have everything you need to
deploy to local VMs, even with no network connection at all. I wrote
about this <a href="pip-install-lightspeed-and-bulletproof">a while ago</a>.</p>
<p><strong>&gt;&gt; Building your code separately on each host will cause
consistency issues</strong></p>
<p>So don't install dependencies using source packages, use wheels instead.
Then any slow or unreliable build step is done once, when you create the
packages directory, while deployment is now reliable and requires no
development tools on the production server such as compilers, headers,
etc.</p>
<p><strong>Update:</strong> As a bonus, this will again substantially speed up the
creation of your virtualenv when deploying.</p>
<p><strong>&gt;&gt; Deploys will fail if the PyPI or your git server are down</strong></p>
<p>PyPI outages (or a package author deleting their package, which happens
routinely) are not a problem if you're deploying from a local source of
packages.</p>
<p>I agree that application code deployment shouldn't be done using a 'git
pull'. Accessibility to GitHub shouldn't be a single point of failure,
and the fewer development tools needed on production servers the better.
So export the code from git into a tar file when you cut a release, and
then push it out using scp at deploy time.</p>
<p>Having said all that, there are still advantages to having your whole
app and its dependencies handled by a single mechanism like Debian
packages, rather than more bug-prone ad-hoc scripts and Ansible config.
So I'm not at all against the final conclusions of the Nylas article.
(Hugs to you folks at Nylas!)</p>
<p>Dashed this out in ten minutes between daycare pickup and dinner being
ready. Apologies for the inevitable shoddyness.</p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/listen-to-your-phone-through-your-pc-speakers/" class="u-url">Listen to your phone through your PC speakers</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/listen-to-your-phone-through-your-pc-speakers/" rel="bookmark">
            <time class="published dt-published" datetime="2015-03-15T10:50:09-05:00" itemprop="datePublished" title="2015-03-15 10:50">2015-03-15 10:50</time></a>
            </p>
                <p class="commentline">            <a href="posts/listen-to-your-phone-through-your-pc-speakers/#disqus_thread" data-disqus-identifier="cache/posts/listen-to-your-phone-through-your-pc-speakers.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <pre class="code literal-block"><span></span><code><span class="ch">#!/usr/bin/env bash</span>

<span class="c1"># Directs audio input (e.g. mic) to audio output (e.g. speakers),</span>
<span class="c1"># then sleeps forever. Stops audio redirection when it is killed.</span>
<span class="c1"># So, for example, plug your phone into the PC's mic, run 'listen',</span>
<span class="c1"># and listen to phone audio through your computer's speakers.</span>
<span class="c1">#</span>
<span class="c1"># Requires:</span>
<span class="c1"># sudo apt-get install pactl # Ubuntu</span>

<span class="nb">set</span> -e

<span class="nv">module</span><span class="o">=</span><span class="k">$(</span>pactl load-module module-loopback<span class="k">)</span>

<span class="k">function</span> cleanup <span class="o">{</span>
    pactl unload-module <span class="nv">$module</span>
<span class="o">}</span>

<span class="nb">trap</span> cleanup EXIT

sleep infinity
</code></pre>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/understanding-rebase-so-it-sticks/" class="u-url">Understanding git rebase so it sticks</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/understanding-rebase-so-it-sticks/" rel="bookmark">
            <time class="published dt-published" datetime="2014-02-07T10:28:37-06:00" itemprop="datePublished" title="2014-02-07 10:28">2014-02-07 10:28</time></a>
            </p>
                <p class="commentline">            <a href="posts/understanding-rebase-so-it-sticks/#disqus_thread" data-disqus-identifier="cache/posts/understanding-rebase-so-it-sticks.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>I endlessly misremember how to use git rebase. That ends today. Here are
my notes to help me remember.</p>
<p>Rebase is traditionally documented as:</p>
<pre class="code literal-block">git rebase <span class="o">[</span>--onto newbase<span class="o">]</span> <span class="o">[</span>upstream <span class="o">[</span>branch<span class="o">]]</span>
</pre>
<p>This is confusing for several reasons. A slight improvement is to rename
the args:</p>
<pre class="code literal-block">git rebase <span class="o">[</span>--onto target<span class="o">]</span> <span class="o">[</span>exclude <span class="o">[</span>include<span class="o">]]</span>
</pre>
<p>Where:</p>
<ul>
<li>
<code>include</code> is the tip of the branch to be transplanted. If omitted,
    it defaults to the current branch.</li>
<li>
<code>exclude</code> excludes all its ancestors from being transplanted. Hence
    the transplanted branch will have its tip at <code>include</code>, and its base
    at the common ancestor of <code>include</code> and <code>exclude</code>. If <code>--onto</code> isn't
    specified, <code>exclude</code> is also used as the destination for the
    transplant.</li>
<li>
<code>target</code> is the place to transplant the branch to. If not specified,
    it defaults to the value of <code>exclude</code>.</li>
</ul>
<p>Hence, a simple before and after:</p>
<pre class="code literal-block">o---o---o---o---o---o exclude
     \
      1---2---3 current branch
                or include
</pre>
<pre class="code literal-block">git rebase exclude <span class="o">[</span>include<span class="o">]</span>
</pre>
<pre class="code literal-block">                exclude
                v
o---o---o---o---o---1---2---3 current branch
                              or include
</pre>
<p>See how the commits to be transplanted start at <code>include</code> and go back to
the common ancestor of that and <code>exclude</code>. Since <code>--onto</code> isn't
specified, <code>exclude</code> is also used as the transplant destination.</p>
<p>Or a more complex one:</p>
<pre class="code literal-block"> o---o---o---o---o target
      \
       o---o---o exclude
            \
             1---2 current branch
                   or include
</pre>
<pre class="code literal-block">git rebase --onto target exclude <span class="o">[</span>include<span class="o">]</span>
</pre>
<pre class="code literal-block">                    target
                    v
    o---o---o---o---o---1---2 current branch
         \                    or include
          o---o---o
                  ^
                  exclude
</pre>
<p>Again, the commits to be transplanted are defined by <code>include</code> and
<code>exclude</code>, but this time a separate destination is specified using
<code>--onto</code>.</p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/this-gaming-life-travels-in-three-cities/" class="u-url">This Gaming Life: Travels in Three Cities</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/this-gaming-life-travels-in-three-cities/" rel="bookmark">
            <time class="published dt-published" datetime="2014-02-03T20:31:29-06:00" itemprop="datePublished" title="2014-02-03 20:31">2014-02-03 20:31</time></a>
            </p>
                <p class="commentline">            <a href="posts/this-gaming-life-travels-in-three-cities/#disqus_thread" data-disqus-identifier="cache/posts/this-gaming-life-travels-in-three-cities.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p><span style="float: left">
<img alt="gaminglife" src="files/2014/02/gaminglife.jpg"></span></p>
<p><em>by Jim Rossignol</em> (2009)</p>
<p>A gorgeous insider's look at videogaming culture, by an author who,
after an unfulfilling stint as a financial journalist, has built his
life around games.</p>
<p>Broken into sections corresponding with the author's experiences in
London, Seoul and Reykjavik, it's thoughtful and manages to sidestep the
patronising oversimplifications of mainstream media's gaming coverage.</p>
<p>From <em>Tetris</em> and <em>Elite</em> to <em>Okami</em> and <em>Shadow of the Collossus</em>,
stopping along the way to examine the modding and indie scenes, the
massively multiplayer intricacies of <em>EVE Online</em>, and the insane
heights of Korean real-time strategy matches. He knows the best <em>Prince
of</em> <em>Persia</em> was <em>Sands of Time</em>, by a country mile. He's one of us. I
felt welcomed to his world. Join us - we'll be on the sofa.</p>
<p>Rating:</p>
<p>10/10 if you understand that games have the potential to become the
dominant art form of the 21st century.</p>
<p>0/10 if it's just for kids, innit?</p>
<p><br style="clear: left"></p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/object-oriented-software-engineering-a-use-case-driven-approach/" class="u-url">Object-Oriented Software Engineering : A Use Case Driven Approach</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/object-oriented-software-engineering-a-use-case-driven-approach/" rel="bookmark">
            <time class="published dt-published" datetime="2014-02-02T14:26:43-06:00" itemprop="datePublished" title="2014-02-02 14:26">2014-02-02 14:26</time></a>
            </p>
                <p class="commentline">            <a href="posts/object-oriented-software-engineering-a-use-case-driven-approach/#disqus_thread" data-disqus-identifier="cache/posts/object-oriented-software-engineering-a-use-case-driven-approach.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p><span style="float: left">
<img alt="Object Oriented Software Engineering cover" src="files/2014/02/object-oriented-sofware-engineering.jpg"></span></p>
<p><em>by Ivar Jacobsen</em> (1992, 4th revision)</p>
<p>You might wonder if there's anything left to say about
object-orientation that hasn't already been discussed to death. I was
led to this 1992 book by Uncle Bob's talk "<a href="http://www.youtube.com/watch?v=WpkDN78P884">Architecture: The Lost
Years</a>." In it Bob posits
that in the 1990s, just as people like Ivar were completing their
20-year journey of figuring out some fairly optimal ways to do
object-orientation, along came the disruptive influence of the web,
which turned everyone's priorities, methodologies and designs upside
down. In the resulting stampede, some highly practical ideas have been
lost, both in terms of design and process. This has substantially
watered down OO's ability to deliver on its promises of reuse and
maintainability. It has stranded a whole generation of applications with
distorted architectures, inside-out designs, and less maintainable code.</p>
<p>Aspects of these historical approaches do survive, such as the
prominence Agile gives to use-cases as a way to concretely tie together
requirements, design, testing, and acceptance. But some equally powerful
ideas, such as appropriate ways to manage dependencies within an
application, have seen relatively little use, and are only now being
rediscovered in guises such as the clean and hexagonal architectures.</p>
<p>Ivar's book can certainly lay claim to being one of the earliest
published sources to lay out these ideas, and he does so with a style
that is convincingly thoughtful. This is the work of an intelligent man,
honed and refined over many years of practice. The omission of modern
testing techniques are the only thing that substantially dates the
content. Otherwise I found it exciting, insightful and revolutionary. It
seems naive to claim that this book describes the One True Architecture
which is applicable to all systems. But it certainly seems very widely
applicable, and has deeply affected my thinking on all projects larger
than a couple of weeks' work.</p>
<p>The book also discusses software development methodology in an
intriguingly meta way, constructing an object-oriented model of the
process itself. Each software development team or organisation
represents a particular implementation of this model. Parallels with the
execution of software are drawn, with the output of one part of the
process, e.g. design work, having to produce results that conform to the
expectations of the downstream process, such as implementation. In this
way, sections of the process can be removed and replaced by compatible
alternatives, to better suit the application domain and the organisation
within which the project is embedded. These ideas seem less immediately
applicable and actionable. Maybe that's just my personal circumstance.
Perhaps they are more applicable to larger projects, which I avoid these
days.</p>
<p>Rating:</p>
<p>10/10 if you're going to enjoy 500 pages of software design principles
and case studies.</p>
<p>0/10 if you're not.</p>
<p><br style="clear: both"></p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/altered-carbon/" class="u-url">Altered Carbon</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/altered-carbon/" rel="bookmark">
            <time class="published dt-published" datetime="2014-02-02T12:59:43-06:00" itemprop="datePublished" title="2014-02-02 12:59">2014-02-02 12:59</time></a>
            </p>
                <p class="commentline">            <a href="posts/altered-carbon/#disqus_thread" data-disqus-identifier="cache/posts/altered-carbon.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p><span style="float: left">
<img alt="Altered Carbon cover" src="files/2014/02/richard-morgan-altered-carbon.jpg"></span></p>
<p><em>by Richard Morgan</em> (2001)</p>
<p>A romp through a hyperviolent cyberpunk future through the eyes of a
character reluctantly press-ganged into the role of detective in a story
woven around personality uploads, swaps, and backups. I did enjoy it,
but was put off by the main character winning their victories
by consecutive applications of remorseless violence. There's no cleverness
or examinations of morality here, just that the character cast as the "goodie"
triumphs by being better at beating people up.</p>
<p>10/10 if you're looking to kick back on the couch with tea, cake, and
some exciting SF.</p>
<p>0/10 if you're not.</p>
<p><br style="clear: both"></p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/domain-driven-design-tackling-complexity-in-the-heart-of-software/" class="u-url">Domain Driven Design: Tackling Complexity in the Heart of Software</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/domain-driven-design-tackling-complexity-in-the-heart-of-software/" rel="bookmark">
            <time class="published dt-published" datetime="2014-01-27T11:05:53-06:00" itemprop="datePublished" title="2014-01-27 11:05">2014-01-27 11:05</time></a>
            </p>
                <p class="commentline">            <a href="posts/domain-driven-design-tackling-complexity-in-the-heart-of-software/#disqus_thread" data-disqus-identifier="cache/posts/domain-driven-design-tackling-complexity-in-the-heart-of-software.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p><span style="float: left">
<img alt="Domain Driven Design cover" src="files/2014/01/domaindrivendesign.jpg"></span></p>
<p><em>by Eric Evans (2004)</em></p>
<p>It's a big, dense book -- possibly the most important of the technical
books I've read in a flurry over the last few months, catching up after
recovering a modicum of sanity in our lives after our kid's first year.
I finish it feeling changed, invigorated, and given new direction.</p>
<p>At its core is a simple idea, which sounds neither new nor revolutionary
on the surface. Software projects, Evans maintains, should work closely
with business experts to create and maintain a domain model. The model
might be expressed as a class diagram of core business concerns, and
should also correspond directly to a body of code modelling these
business entities. This forms a set of core business entities which are
clearly analogous to things like the core enterprise entities of the
hexagonal or clean architectures.</p>
<p>However it's created, the terminology and notation used in the class
diagram (or it's equivalent) should be well understood by individuals on
both side of the tech/business divide. In the past I think I've made the
mistake of believing that only developers needed to understand it, and
therefore the model only needed to be expressed in code.</p>
<p>This model should be displayed prominently, referred to continually, and
in a healthy project should very directly correspond to the specialised
language that evolves within the organisation. Where the team's language
doesn't match the model - for example, your business experts' use of
plurals betrays that the cardinality of relationships are modelled
wrongly, then the model - and the underlying code - should be
aggressively refactored to match reality.</p>
<p>Evans makes a persuasive case that the appropriate management of this
complexity at the heart of your software will be a major influence on
the success of the project. To be fair, this is a viewpoint that I
already believed in, so I was a sucker for all of this. Without an
appropriate approach to these central design concerns, over time
developers will find they are no longer able to understand the code
thoroughly enough to be able to modify or extend it easily, unless they
deliberately or inadvertently use design-breaking hacks like redundancy
or mislocated chunks of code. This forms a vicious cycle of technical
debt accrual, and creates an upper limit on the size or complexity which
can be achieved by any project before productivity begins to slump.
Other metrics like reliability then also suffer.</p>
<p>To counter this, conquering these central design issues requires a
pro-active and multi-pronged effort. Firstly, the existing design must
be understood by all parties. In order for this to remain true, the
design needs to be kept up to date and be easily understood by new team
members. The code must be kept directly in sync with the model, and kept
understandable - inappropriate dependencies must be ruthlessly pruned.
Simultaneously, the "correct" design must be discovered iteratively,
throughout the life of the project, and this can only be done by
encouraging continual conversations between developers and business
folks to discuss the potential inadequacies of the current design and
possible alternatives.</p>
<p>When managed correctly, this lends an agility and suppleness to project.
Developers find it easy to integrate subsequent parts of code because
they 'fit naturally' into the existing design, and when the design is
found wanting, it's relatively easy to modify it to incorporate new
concerns.</p>
<p>There are times when I've struggled to convey the message about how the
resulting trade off works between time spent refactoring versus time
saved over the long term. Evans describes this in an interesting way.
Instead of trying to model team productivity by applying a multiplier to
describe drag caused by technical debt, he simply contrasts the normal
way projects slow down as they become larger and more complex, with a
project that instead <em>speeds up</em> over time, as developers, unhindered by
a cycle of technical debt, are instead empowered by the creation of
powerful and expressive abstractions, which can then be relatively
easily reconfigured into unanticipated configurations.</p>
<p>To counter-balance this idealistic hand-waving, the next section dives
right into some specific design practices which embody these ideas.
These are valuable and insightful, stock-in-trade, such as
distinguishing between entity and value types. But many of the ideas
were completely new to me, such as the concept of <em>aggregates</em>, which
define subsets of the domain model which are always atomically retrieved
from (or updated in) a data store.</p>
<p>In short, I really loved this book. It stretched and inspired me. It's
in a very small set of books I've flagged to re-read in a couple of
years. It's top of my list for 'books to bring in and talk about at
work'.</p>
<p>Rating:</p>
<p>10/10 if you're a programmer, or work with programmers.</p>
<p>0/10 if you're not, or don't.</p>
<p><br style="clear: both"></p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/brief-interviews-with-hideous-men/" class="u-url">Brief Interviews with Hideous Men</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/brief-interviews-with-hideous-men/" rel="bookmark">
            <time class="published dt-published" datetime="2014-01-22T20:51:51-06:00" itemprop="datePublished" title="2014-01-22 20:51">2014-01-22 20:51</time></a>
            </p>
                <p class="commentline">            <a href="posts/brief-interviews-with-hideous-men/#disqus_thread" data-disqus-identifier="cache/posts/brief-interviews-with-hideous-men.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p><span style="float: left; padding: 1em">
<img alt="Brief Interviews With Hideous Men cover" src="files/2014/01/brief-interviews-with-hideous-men.jpg"></span></p>
<p><em>by David Foster Wallace (1999)</em></p>
<p>A collection of creative essays, varying from playful to unflinchingly
uncomfortable, shot through with Wallace's typical humour and
introspection.</p>
<p>I've tended to love and hate his <a href="infinite-jest">other</a>
<a href="everything-and-more">writing</a> in equal measure, but with such
ferocity that I unreservedly place him amongst my very favourite
authors. There wasn't even much for me to hate in this one, relatively
lacking as it is in labyrinthine footnotes.</p>
<p>A couple of the essays left me cold (<em>Tri-Stan: I Sold Sissee Nar to
Ecko</em> springs to mind - presumably I'm missing the point entirely),
but most of them I found thoroughly engaging and
thought provoking. I'm tempted to read up on those that seemed most
challenging to me (<em>Church Not Made With Hands</em>, say), and give them
another try.</p>
<p>It's been a while. Rating:</p>
<p>0/10 if you don't want to delve deeply into sometimes uncomfortable
subjects, such as depression, unconventional sex acts, and rape.</p>
<p>10/10 if you like to be stretched, or at least stirred around, in
interesting directions.</p>
<p><br style="clear: both"></p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/chaining-a-sequence-of-generators/" class="u-url">Chaining a sequence of generators</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/chaining-a-sequence-of-generators/" rel="bookmark">
            <time class="published dt-published" datetime="2013-10-15T15:09:54-05:00" itemprop="datePublished" title="2013-10-15 15:09">2013-10-15 15:09</time></a>
            </p>
                <p class="commentline">            <a href="posts/chaining-a-sequence-of-generators/#disqus_thread" data-disqus-identifier="cache/posts/chaining-a-sequence-of-generators.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>I often gravitate towards solutions using a series of chained
generators, in the style of David Beazley's '<a href="http://www.dabeaz.com/generators-uk/">Generator Tricks for
Systems Programmers</a>.'</p>
<p>This results in the outer level of my code calling one generator after
another, terminating in something that consumes the rows, pulling data
one row at a time through each of the generators:</p>
<pre class="code literal-block"><span class="n">inputRows</span> <span class="o">=</span> <span class="n">read</span><span class="p">()</span>
<span class="n">parsedRows</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">inputRows</span><span class="p">)</span>
<span class="n">processedRows</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="n">parsedRows</span><span class="p">)</span>
<span class="n">outputRows</span> <span class="o">=</span> <span class="n">format_</span><span class="p">(</span><span class="n">processedRows</span><span class="p">)</span>
<span class="n">output</span><span class="p">(</span><span class="n">outputRows</span><span class="p">)</span>
</pre>
<p>where each called function except the last is actually a generator, e.g:</p>
<pre class="code literal-block"><span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
        <span class="k">yield</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</pre>
<p>This is great. But my itch is that the top level code above is a bit
wordy, given that what it does is so simple. The reader has to check
each temporary variable quite carefully to be sure it's doing the right
thing.</p>
<p>Fowler's 'Refactoring' describes circumstances when <a href="http://www.refactoring.com/catalog/replaceTempWithQuery.html">it's good to remove
intermediate
variables</a>,
which results in:</p>
<pre class="code literal-block"><span class="n">output</span><span class="p">(</span> <span class="n">format_</span><span class="p">(</span> <span class="n">process</span><span class="p">(</span> <span class="n">parse</span><span class="p">(</span> <span class="n">read</span><span class="p">()</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
</pre>
<p>This is certainly less wordy, and expresses what's happening very
directly, but it annoys some of my colleagues that the called functions
are listed in reverse order from what one might intuitively expect.</p>
<p>I've had this idea in my head to create a decorator for generators which
allows one to chain them in an intuitive order, possibly using some
unconventional notation such as:</p>
<pre class="code literal-block"><span class="n">read</span><span class="p">()</span> <span class="o">|</span> <span class="n">parse</span> <span class="o">|</span> <span class="n">process</span> <span class="o">|</span> <span class="n">format_</span> <span class="o">|</span> <span class="n">output</span>
</pre>
<p>where 'parse', et al, are now decorated with '@chainable' or somesuch,
which returns an instance of a class that stores the wrapped generator,
and overrides __or__ to do its magic. Maybe 'read' doesn't need to
be invoked manually there at the start of the chain. I haven't really
thought this through.</p>
<p>Luckily, before embarking on that, I realised today I've been
over-complicating the whole thing. There's no need for decorators, nor
for the cute '|' syntax. I just need a plain old function:</p>
<pre class="code literal-block"><span class="k">def</span> <span class="nf">link</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="o">*</span><span class="n">transforms</span><span class="p">):</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">source</span>
    <span class="k">for</span> <span class="n">transform</span> <span class="ow">in</span> <span class="n">transforms</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">args</span>
</pre>
<p><strong>Update</strong>: This code has been improved thanks to suggestions in the
comments from Daniel Pope (eliminate the 'first' variable) and Xtian
(take an iterable rather than a callable for the source.)</p>
<p>This assumes the first item passed to link is an iterable, and each
subsequent item is a generator that takes the result of the item before.</p>
<p>If the final item in the sequence passed to 'link' is a generator, then
this returns a generator which is the composite of all the ones passed
in:</p>
<pre class="code literal-block"><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">link</span><span class="p">(</span><span class="n">read</span><span class="p">(),</span> <span class="n">parse</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span> <span class="n">format_</span><span class="p">):</span>
    <span class="nb">print</span> <span class="n">item</span>
</pre>
<p>Or if the final item passed to 'link' is a regular function, which
consumes the preceding generators, then calling 'link' will invoke the
generators, i.e. the following is the same as the above 'for' loop:</p>
<pre class="code literal-block"><span class="n">link</span><span class="p">(</span><span class="n">read</span><span class="p">(),</span> <span class="n">parse</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span> <span class="n">format_</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
</pre>
<p>There's some rough edges, such as determining what to do if different
generators require other args. Presumably 'partial' could help here. But
in general, 'link' only needs to be written once, and I'm liking it.</p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/pip-install-lightspeed-and-bulletproof/" class="u-url">pip install : Lightspeed and Bulletproof</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/pip-install-lightspeed-and-bulletproof/" rel="bookmark">
            <time class="published dt-published" datetime="2013-03-08T09:29:09-06:00" itemprop="datePublished" title="2013-03-08 09:29">2013-03-08 09:29</time></a>
            </p>
                <p class="commentline">            <a href="posts/pip-install-lightspeed-and-bulletproof/#disqus_thread" data-disqus-identifier="cache/posts/pip-install-lightspeed-and-bulletproof.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>I saw a post about <a href="http://www.scottisheyes.com/how-to-fix-slow-pip-install">speeding up the Python packaging command "pip
install"</a>, by
specifying more responsive mirrors for querying and downloading
packages. For my situation, a better tactic is this.</p>
<p>Step one: Download all your project's dependencies into a local
'packages' dir, but don't install them yet:</p>
<pre class="code literal-block">mkdir packages
pip install --download<span class="o">=</span>packages -r requirements.txt
</pre>
<p>Step two, install from the 'packages' dir:</p>
<pre class="code literal-block">pip install --no-index --find-links<span class="o">=</span>packages -r requirements.txt
</pre>
<p><em>(The above syntax works on pip 1.3, released yesterday. Docs for older
versions of pip claim to support this, but in practice, for pip 1.2,
I've had to use "<code>--find-links=file://$PWD/packages</code>")</em></p>
<p>Step 2 works even if PyPI is unreachable. It works even if some of your
dependencies are self-hosted by the authors, and that website is
unreachable. It works even if the version you have pinned of one of your
dependencies has been deleted by the author (some packages do this
routinely after security updates.) It works even if you have no network
connection at all. In short, it makes creation of your virtualenv
bulletproof.</p>
<p>As a nice side effect, it runs really fast, because it isn't downloading
the packages across the internet, nor is it attempting to scan a remote
index to check for matching or newer versions of each package. This is
much quicker than just using a Pip download cache, especially for large
projects with many dependencies which only change occasionally.</p>
<p>At <a href="http://rangespan.com">Rangespan</a>, we check the 'packages' directory
into source control, so that once you've checked out a project's repo,
you have everything you need to deploy locally and run, even if you have
no network. You might choose to treat 'packages' as ephemeral.</p>
<p>It was pointed out to me recently by
<a href="https://twitter.com/jezdez">@jezdez</a>, Pip maintainer, this usage
pattern has now been <a href="http://www.pip-installer.org/en/latest/cookbook.html#fast-local-installs">explicitly called out in the
documentation</a>,
which was substantially reorganised and improved with the recent 1.3
release.</p>
</div>
    </div>
    </article>
</div>
        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-22.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-20.html" rel="next">Older posts</a>
            </li>
        </ul></nav><script>var disqus_shortname="tartley";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div>
        <!--End of body content-->

        <footer id="footer"></footer>
</div>
</div>

            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
