<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="A website devoted to oneself has been described — by my own Father, no less — as the greatest act of hubris. Welcome aboard!">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>tartley.com</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="rss.xml">
<link rel="canonical" href="https://www.tartley.com/">
<link rel="icon" href="welcome.gif" sizes="16x16">
<link rel="next" href="index-28.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]--><link rel="prefetch" href="posts/overhauled-manual-for-epomaker-galaxy80-keyboard/" type="text/html">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://www.tartley.com/">

                <span id="blog-title">tartley.com</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Posts</a>
                </li>
<li>
<a href="tags/">Tags</a>
                </li>
<li>
<a href="galleries/Drawings">Gallery</a>
                </li>
<li>
<a href="rss.xml">RSS</a>
                </li>
<li>
<a href="about/">About</a>

                
            </li>
</ul>
<!-- DuckDuckGo custom search --><form method="get" id="search" action="https://duckduckgo.com/" class="navbar-form pull-left">
<input type="hidden" name="sites" value="https://www.tartley.com/"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" name="q" maxlength="255" placeholder="Search…" class="span2" style="margin-top: 4px;"><input type="submit" value="DuckDuckGo Search" style="visibility: hidden;">
</form>
<!-- End of custom search -->


            <ul class="nav navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    <a rel="me" href="https://mastodon.social/@tartley"></a>
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/overhauled-manual-for-epomaker-galaxy80-keyboard/" class="u-url">Overhauled Manual for Epomaker Galaxy80 Tri-Mode Keyboard</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/overhauled-manual-for-epomaker-galaxy80-keyboard/" rel="bookmark">
            <time class="published dt-published" datetime="2024-11-03T18:22:45-06:00" itemprop="datePublished" title="2024-11-03 18:22">2024-11-03 18:22</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Loving the new keyboard, an Epomaker Galaxy80 with Feker Marble White switches.</p>
<p>My requirements are pretty much the same as last time I bough a keyboard:</p>
<ul>
<li>Tenkeyless layout, or TKL as it's known, i.e. without a numpad. The kiddo and
  I fit two side-by-side gaming stations at this desk, and the extra
  mouse-swiping space is precious, as is the ergonomics of putting the mouse
  just a few inches closer.</li>
<li>Standard ANSI layout, to match the other keyboards I commonly use.</li>
<li>Mechanical, although I'm not experienced enough to know a good one from a bad
  one.</li>
<li>At least two connections which are easy to switch between, for work and
  personal computers. This one has five, three of which are Bluetooth.</li>
<li>At least one of those connections should be reasonably low latency, i.e. &lt;5ms,
  which means wired or a dedicated 2.4GHz dongle, not Bluetooth. The Galaxy80
  has both. I'm a long way away from being a pro gamer, but even down here in
  the GamerDad leagues, I seem to be more aware of annoying latency than most
  people are.</li>
<li>Backlit. I don't especially care about per-key RGB, but that seems to be
  extremely common. Shine-through keycaps would be nice, but these seem to be
  increasingly rare outside of garish gamer-boi cyber-monstrosities, so not a
  big deal.</li>
<li>Hot-swappable switches. This is the requirement I compromised on last time I
  bought a keyboard, settling for the Logitech G915, which was great, but got
  old after switches started failing. I'm tired of desoldering them and am
  noping out to buy something else, a mere 16 months later.</li>
<li>Not egregiously incompatible with Linux. It would be hard to find a keyboard
  which doesn't actually work with Linux, but maybe some manufacturer has buried
  some vital configuration detail in badly written Windows-only configuration
  software that doesn't play nice with Wine, etc.</li>
<li>Without expensive features I don't need, like configurable activation height,
  or OLED screens.</li>
</ul>
<p>The switches are described as sounding "like marbles clacking", which worried me
that they might be too loud and piercing. But now it's arrived, they are
actually quieter than any other mechanical switch I've had. The sound is deeper
than I expected. Recognizably like marbles, but merged with the sound of
pebbles, and a hint of a wooden xylophone.</p>
<p>I really like it! Although since pulling the trigger I've seen that Reddit
doesn't like Epomaker. I'm just not going to read those posts for now.</p>
<p>As seems traditional with all keyboards, the manual is quite hard to read.
Here's <a href="files/2024/Keyboard-Ecomaker-Galaxy80-tri-mode-mine.pdf">my overhauled manual</a>, for future reference.</p>
<p><strong>Update</strong>: The incantations needed to get function keys working the way
you want them to on Ubuntu :eyeroll: etc (<a href="https://www.reddit.com/r/Epomaker/comments/1bte204/galaxy80_cant_use_functionkeys_in_linux/">via Reddit</a>):</p>
<div class="code"><pre class="code literal-block"><span class="nb">echo</span><span class="w"> </span><span class="s2">"options hid_apple fnmode=2"</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/modprobe.d/hid_apple.conf
sudo<span class="w"> </span>update-initramfs<span class="w"> </span>-u
</pre></div>

<p>and reboot.</p>
<hr>
</div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/til-constructing-a-pdf-from-jpg-image-files/" class="u-url">TIL: Constructing a PDF from .jpg image files</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/til-constructing-a-pdf-from-jpg-image-files/" rel="bookmark">
            <time class="published dt-published" datetime="2024-10-21T09:55:18-05:00" itemprop="datePublished" title="2024-10-21 09:55">2024-10-21 09:55</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have some folders of .jpg images that make up a comic. I want to convert them into a PDF to read
on my tab and other devices, and import into by bookshelf in Calibre.</p>
<h3>1. Install some prerequisites</h3>
<div class="code"><pre class="code literal-block">sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>imagemagick<span class="w"> </span>pdftk
</pre></div>

<h3>2. Do the conversion</h3>
<p>The versatile ImageMagick has a 'convert' command that seems to handle it:</p>
<div class="code"><pre class="code literal-block">convert<span class="w"> </span>*.jpg<span class="w"> </span>output.pdf
</pre></div>

<p>But this has some issues:</p>
<h4>2.1. Failure due to security policy</h4>
<p>'convert' currently refuses to generate PDFs: 'attempt to perform an operation not allowed by the security policy'. Apply the fix described on <a href="https://stackoverflow.com/questions/52998331/imagemagick-security-policy-pdf-blocking-conversion">StackOverflow</a>. :eyeroll:</p>
<h4>2.2. Failure due to cache space</h4>
<p>You might not need this fix if you generate smaller documents, or generate chapter-by-chapter as
described below, but here it is in case.</p>
<p>Don't close that editor! In the same policy.xml you were just editing are resource size declarations for memory and disk. If 'convert' barfs with an error about running out of cache space, then bump
up the disk resource size. I set mine to 8GB. <a href="https://unix.stackexchange.com/questions/329530/increasing-imagemagick-memory-disk-limits">StackOverflow again</a> for details. :eyeroll: again.</p>
<h3>3. Include a table of contents</h3>
<p>I want to add bookmarks to the generated PDF marking each chapter.</p>
<p>Put the .jpgs into subdirectories by chapter, eg:</p>
<div class="code"><pre class="code literal-block">src/
|--chapter01/
|  |--0001.jpg
|  |--0002.jpg
|  |  ...
|--chapter02/
|  |--0001.jpg
|  |--0002.jpg
|  |  ...
|
...
</pre></div>

<p>Pad the chapter numbers with preceding zeros so that they sort into the correct order. I added
an artificial 'chapter00' containing the front cover, separate from individual chapters.</p>
<p>Now we need to generate individual PDFs for each chapter. We can then use 'pdftk' to
count the number of pages in each chapter, and use those counts to place bookmarks on
the correct pages when pfdtk combines the chapters into one final output PDF.</p>
<p>I ended up regenerating each chapter a bunch while I tweaked the content, such as deleting adverts
from the images. So I put these commands into a Makefile:</p>
<div class="code"><pre class="code literal-block"><span class="nf">help</span><span class="o">:</span><span class="w"> </span><span class="c">## Show this help.</span>
<span class="w">    </span>@grep<span class="w"> </span>-E<span class="w"> </span><span class="s1">'^[^_][a-zA-Z_\/\.%-]+:.*?## .*$$'</span><span class="w"> </span><span class="k">$(</span>MAKEFILE_LIST<span class="k">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">'BEGIN {FS = ":.*?## "}; {printf "\033[36m%-12s\033[0m %s\n", $$1, $$2}'</span>
<span class="nf">.PHONY</span><span class="o">:</span><span class="w"> </span><span class="n">help</span>

<span class="nv">chapter_dirs</span><span class="o">=</span><span class="k">$(</span>wildcard<span class="w"> </span>src/*<span class="k">)</span>
<span class="nv">chapters</span><span class="o">=</span><span class="k">$(</span>chapter_dirs:src/%<span class="o">=</span>%<span class="k">)</span>
<span class="nv">chapter_pdfs</span><span class="o">=</span><span class="k">$(</span>chapters:%<span class="o">=</span>%.pdf<span class="k">)</span>
<span class="nv">bookmarks</span><span class="o">=</span>bookmarks.txt
<span class="nv">output</span><span class="o">=</span>output.pdf

<span class="nf">clean</span><span class="o">:</span><span class="w"> </span><span class="c">## Delete all generated PDFs</span>
<span class="w">    </span>rm<span class="w"> </span>-f<span class="w"> </span><span class="k">$(</span>chapter_pdfs<span class="k">)</span><span class="w"> </span><span class="k">$(</span>output<span class="k">)</span>
<span class="nf">.PHONY</span><span class="o">:</span><span class="w"> </span><span class="n">clean</span>

<span class="nf">chapter%.pdf</span><span class="o">:</span><span class="w"> </span><span class="n">src</span>/<span class="n">chapter</span>%/*.<span class="n">jpg</span> <span class="c">## Each individual chapter, use 2 digits</span>
<span class="w">    </span>convert<span class="w"> </span>src/chapter<span class="nv">$*</span>/*.jpg<span class="w"> </span><span class="nv">$@</span>

<span class="nf">$(bookmarks)</span><span class="o">:</span><span class="w"> </span><span class="k">$(</span><span class="nv">chapter_pdfs</span><span class="k">)</span>
<span class="w">    </span>./make-bookmarks<span class="w"> </span>&gt;<span class="k">$(</span>bookmarks<span class="k">)</span>

<span class="nf">$(output)</span><span class="o">:</span><span class="w"> </span><span class="k">$(</span><span class="nv">chapter_pdfs</span><span class="k">)</span> <span class="k">$(</span><span class="nv">bookmarks</span><span class="k">)</span>
<span class="w">    </span>pdftk<span class="w"> </span><span class="k">$(</span>chapter_pdfs<span class="k">)</span><span class="w"> </span>cat<span class="w"> </span>output<span class="w"> </span>-<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>pdftk<span class="w"> </span>-<span class="w"> </span>update_info<span class="w"> </span><span class="s2">"</span><span class="k">$(</span>bookmarks<span class="k">)</span><span class="s2">"</span><span class="w"> </span>output<span class="w"> </span><span class="s2">"</span><span class="k">$(</span>output<span class="k">)</span><span class="s2">"</span>

<span class="nf">all</span><span class="o">:</span><span class="w"> </span><span class="k">$(</span><span class="nv">output</span><span class="k">)</span> <span class="c">## Build final output PDF</span>
<span class="nf">.PHONY</span><span class="o">:</span><span class="w"> </span><span class="n">all</span>
</pre></div>

<p>Where 'make-bookmarks' is a bash script that generates the intermediate 'bookmarks.txt' file:</p>
<div class="code"><pre class="code literal-block"><span class="ch">#!/usr/bin/env bash</span>

<span class="nb">set</span><span class="w"> </span>-e<span class="w"> </span><span class="c1"># exit on error</span>
<span class="nb">set</span><span class="w"> </span>-u<span class="w"> </span><span class="c1"># treat unset vars as errors</span>
<span class="c1"># set -x # debugging output</span>
<span class="nb">set</span><span class="w"> </span>-o<span class="w"> </span>pipefail

<span class="c1"># Generate a bookmarks file for all the matching PDF files</span>

<span class="nv">fmt</span><span class="o">=</span><span class="s2">"BookmarkBegin</span>
<span class="s2">BookmarkTitle: %s</span>
<span class="s2">BookmarkLevel: 1</span>
<span class="s2">BookmarkPageNumber: %d</span>
<span class="s2">"</span>

<span class="nb">declare</span><span class="w"> </span>-a<span class="w"> </span><span class="nv">files</span><span class="o">=(</span>chapter*.pdf<span class="o">)</span>
<span class="nv">page</span><span class="o">=</span><span class="m">1</span>
<span class="k">for</span><span class="w"> </span>file<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">"</span><span class="si">${</span><span class="nv">files</span><span class="p">[@]</span><span class="si">}</span><span class="s2">"</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nv">title</span><span class="o">=</span><span class="s2">"</span><span class="si">${</span><span class="nv">file</span><span class="p">%.*</span><span class="si">}</span><span class="s2">"</span>
<span class="w">    </span><span class="nb">printf</span><span class="w"> </span><span class="s2">"</span><span class="nv">$fmt</span><span class="s2">"</span><span class="w"> </span><span class="s2">"</span><span class="nv">$title</span><span class="s2">"</span><span class="w"> </span><span class="s2">"</span><span class="nv">$page</span><span class="s2">"</span>
<span class="w">    </span><span class="nv">num_pages</span><span class="o">=</span><span class="s2">"</span><span class="k">$(</span>pdftk<span class="w"> </span><span class="s2">"</span><span class="nv">$file</span><span class="s2">"</span><span class="w"> </span>dump_data<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>NumberOfPages<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">'{print $2}'</span><span class="k">)</span><span class="s2">"</span>
<span class="w">    </span><span class="nv">page</span><span class="o">=</span><span class="k">$((</span><span class="nv">page</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">num_pages</span><span class="k">))</span>
<span class="k">done</span>
</pre></div>

<p>Now <code>make all</code> will produce the final output.pdf. You might want to open up the generated
bookmarks.txt and edit the placeholder "chapter01" names. Then run <code>make all</code> again to
regenerate the final output PDF with your fixed chapter names.</p>
<p><img alt="Rorschach II meets Adrian" src="files/2024/doomsday-clock-r2-meets-adrian.webp"></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/til-shell-environment-variable-tricks/" class="u-url">TIL: Shell environment variable tricks</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/til-shell-environment-variable-tricks/" rel="bookmark">
            <time class="published dt-published" datetime="2024-10-03T15:37:27-05:00" itemprop="datePublished" title="2024-10-03 15:37">2024-10-03 15:37</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p><code>envsubst</code> is an executable you likely already have on your PATH (part of the gettext package, often
installed with dev packages), which is a convenient way to replace <code>$VAR</code> or <code>${VAR}</code> style
environment variables with their values. This allows rendering templates without heavyweight
tools like Ansible, Jinja, or embedding with heredocs. Usage is:</p>
<div class="code"><pre class="code literal-block">envsubstr &lt;template &gt;rendered
</pre></div>

<p>For example:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>envsubstr<span class="w"> </span><span class="o">&lt;&lt;&lt;</span><span class="s2">"Hello </span><span class="nv">$USER</span><span class="s2">"</span>
Hello<span class="w"> </span>jonathan
</pre></div>

<p>If you'd like to use KEY=value declarations from a dotenv-style <code>.env</code> file, you can auto-export
them by setting the <code>-a</code> Bash option:</p>
<div class="code"><pre class="code literal-block">set -a; source .env; set +a
</pre></div>

<p>Something I've managed to avoid ever realizing for 30 years, but now that I've seen it I can't
imagine a week going by without using it. The kind of thing that should be part of everyone's "Week
1 in a terminal" training that formal education courses never include.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/ferris-buellers-day-off/" class="u-url">Ferris Bueller's Day Off</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/ferris-buellers-day-off/" rel="bookmark">
            <time class="published dt-published" datetime="2023-09-27T10:01:22-05:00" itemprop="datePublished" title="2023-09-27 10:01">2023-09-27 10:01</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p><span style="float: left">
<img alt="Ben Stein in Ferris Bueller's Day Off" src="files/2023/ferris-bueller.webp"></span></p>
<p><em>Directed and written by John Hughes, 1986.</em> <a href="https://www.imdb.com/title/tt0091042">IMDB</a></p>
<p>So, way back in my teen years, we had a VHS tape of this, which friends and I
played and played and played, probably racking up more rewatches than any other
movie in my life. So it was a pleasure to break it out for our 11 year-old,
some some 37 years later (!), to see whether it still holds up, and find that
it really does.</p>
<p>By chance this was the week after we'd just watched <em>The Blues Brothers</em>, so we
got to compare and contrast two movies set in Chicago - a privileged white
story, and a poverty stricken, largely colored one, which even share scenes
filmed in the very same restaurant.</p>
<p>Back then, I had no idea who Ben Stein was, so it was amusing to see him now
and suddenly join the dots. Apparently his infamous "voodoo economics" speech
had no script and was ad-libbed.</p>
<p>Reviewing Rooney's comical attempts to break into the Buellers' house made me
realize for the first time that this was Hughes' dry-run at what would become
<em>Home Alone</em>.</p>
<p>I had always been frustrated that I'd never been able to lay my hands on the
"<em>You're not dying</em>" song that Cameron plays while sick in his bedroom (i.e. here's the few seconds
of it
<a href="https://www.youtube.com/watch?v=6mcFGW0RjAo&amp;t=70s&amp;autoplay=1">on Youtube</a>,
exactly as it appears in the movie.)</p>
<p>Now we have the Internet, I can see that this failure wasn't exactly my fault -
there is no such song. The few bars we hear were whipped up by Ira Newborn
specially for the film, based on an old Louis Armstrong song,
<a href="https://youtu.be/fHbC8Nhd46s?autoplay=1"><em>Let My People Go</em></a>. Fortunately for us,
one man was obsessed about it enough to actually recreate a full length
song based on the snippets from the movie. Here is Daniel Simone's
<a href="https://youtu.be/MDEXlOk_suM?autoplay=1">Let My Cameron Go</a>,
full of a lush Pink Floyd sound, and ripe with the sort of ecstatic
anticipation that even Roger Waters would be proud of.</p>
<p>Duly <a href="posts/download-audio-from-youtube/">added to my rotation</a> for next time I'm sick.</p>
<p><br style="clear: left"><br></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/resolution-and-the-endless/" class="u-url">Resolution and The Endless</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/resolution-and-the-endless/" rel="bookmark">
            <time class="published dt-published" datetime="2023-09-22T14:12:24-05:00" itemprop="datePublished" title="2023-09-22 14:12">2023-09-22 14:12</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p><img alt="Resolution" src="files/2023/resolution.webp"></p>
<p><a href="https://www.imdb.com/title/tt1977895"><em>Resolution (2012)</em></a></p>
<p><img alt="The Endless" src="files/2023/the-endless.webp"></p>
<p><a href="https://www.imdb.com/title/tt3986820"><em>The Endless (2017)</em></a></p>
<p>I only had a hazy awareness of Justin Benson and Aaron Moorhead, the writer
and directors, before watching these movies. But having discovered them, I now
realize that they are doing just about my favorite thing in film: Quirky,
intense, psychological drama wound around some high concept science fiction.</p>
<p>Going in, I hadn't realized the two films are related. But then they contain
the same scene, viewed from two different angles (pictured above), and it
starts to become clearer. As it happens, I watched them out of order - my
enthusiasm for <em>The Endless</em> caused me to look up their earlier <em>Resolution</em>.
But with hindsight, I think this is actually the best order to view them. If
<em>Resolution</em> has a weakness, it's that the science fictional elements seem a
bit arbitrary. Why should this supernatural entity focus its narrative-obsessed
attentions on these two men, here in this cabin, out in the middle of nowhere?
But in <em>The Endless</em>, this particular brand of supernatural outlandishness is
revealed to be just part of a wider pattern, affecting many people in this
geographical area. Although this is the bigger, weirder story, it is more fully
fleshed out and becomes more believable, creating a setting which
recontextualizes and improves the earlier film.</p>
<p>Rating: 10/10 if you like mindbending SF horror, 0/10 if you prefer something a
bit more polished and comfortable.</p>
<p><br></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/aurora/" class="u-url">Aurora</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/aurora/" rel="bookmark">
            <time class="published dt-published" datetime="2023-09-21T15:29:16-05:00" itemprop="datePublished" title="2023-09-21 15:29">2023-09-21 15:29</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p><span style="float: left">
<img alt="Aurora cover" src="files/2023/aurora.webp"></span></p>
<p><em>by Kim Stanley Robinson, 2015</em></p>
<p>It has long been held by fans of science fiction that <em>fantasy</em> is a lowly
subset of science-fiction, or perhaps a disreputable cousin, one for whom
the normal rules of discernment do not apply. If such unlikely and unrealistic
things as dragons and magic are allowed, the reasoning goes, then the book
cannot be relied upon to deliver any kind of coherent narrative experience,
since the lapsed rule-set now allows for any old <em>ex machina</em> plot twists to
save the day. A magical "defeat the evil" spell? No problem. A new mythical
creature capable of defeating the previously unassailable one? Why not? All
reason is gone.</p>
<p>It's more useful though, is to invert the hierarchy of this received wisdom,
and consider science fiction as a subset of fantasy. Mentioning this in fandom
circles blows mental fuses. Does not compute. But the speculative flights of
science fiction are also fantasies. Just fantasies that a particular type of
person finds especially beguiling, compelling, and believable. To some extent,
I concede that on occasion they are believable because they seem to be a
reasonable extrapolation of our current situation. But no matter how reasonable
your extrapolation seems to be, it's always possible that reality will zig
instead of zag, and even the most humdrum tale of a rocket man's life will
find itself at odds with the unexpected reality of suspended human spaceflight
in the face of spiraling real-world costs. The vision that one is selling is
always, to a greater or lesser extent, a wishful one - a <em>fantasy</em>.</p>
<p>This becomes immediately apparent once we stray beyond the confines of low
Earth orbit, to take in the wider scope of science fiction, the vast majority
of which encompasses tales across the galaxy, nay, the universe, including time
travel, teleportation booths, aliens of every color, quantum reality
displacement, and multiversal escapades in which literally everything is
possible. These are very clearly fantasies, and it is intensely curious to me
why this sort of fantasy is considered more "realistic" or "believable" than,
say, flying lizards with fiery breath. Even though the narrative hand-waving
that explains away the former - "It's an alternate <em>universe</em>, where different
rules apply" - is abundantly adequate to more than completely explain anything
in the fantasy realm.</p>
<p>I once asked my guru science fiction critic <a href="https://damiengwalter.com/podcast/">Damien
Walter</a> what makes people consider some
stories believable, while other are not. He replied with a statement that has
stuck with me ever since: People are willing to invest the effort to provide
the conceptual scaffolding around an idea to make it seem believable (e.g. to
speculate on the mechanism that might allow for a faster-than-light
hyper-drive) <em>when the story fulfills some deeper psychological need for them</em>.</p>
<p>Hence, a story on the same topic as <em>Aurora</em>, of a generation ship sent to
colonize an Earth-like planet orbiting the nearby star of Tau Ceti, is
(usually) a story about the triumph of modernism. Such stories leverage the
sources of strength in the modern world, science and technology and
<em>colonialism</em>, and a reader who is invested in a modern world-view will feel
validated and empowered by this type of fantasy. They will be will be willing
to exercise whatever extracurricular creative effort is required on the part of
the reader to make the story believable. Doing so will inspire them with the
feeling that their world all makes sense, is leading to something, so that
their daily grind is a part of the heroic story of how humanity transcends its
planetary origins. This is much more fulfilling than investing any effort
getting on board with the waning powers of superstition that are represented by
the fantasy genre.</p>
<p><span style="background:#bb2200; color:white; border-radius: 1em; padding-left: 0.5em; padding-right: 0.5em; padding-top: 2px;"><b>spoilers</b></span></p>
<p>In keeping with this, Aurora's colonists are granted every conceivable boon
that science and industry can supply. A ship fully ten kilometers across,
enclosing twenty four massive biomes, each stuffed full of hills and lakes,
soil and forests, microbes and wildlife. A population of well over a thousand
human beings. Miraculous nanotech fabricators, and megatons of elemental
feedstock to run them. A miraculous acceleration laser, fired from Titan for
decades after departure, allowing the ship to coast up to 0.1c, making the
journey in only seven generations, while retaining enough fuel to decelerate
for arrival. A miraculous magnetic shield protects the ship from catastrophic
collisions with stray particles along the way. A benign AI runs the ship,
amusingly pressed into service as the narrator of the tale, and grows visibly
more sentient, emotionally robust and capable as the years pass.</p>
<p>And hot damn, they are going to <em>need</em> all these things, because in this story,
human interstellar colonization is revealed for the fantasy it really is.
Nothing works out, and the problems encountered are far bigger than anything
the ship's designers planned for. Although the ship does limp into orbit
around the destination planet, soon after that people start dying, major
disagreements emerge which descend into catastrophic riots, and the ship's
society falls apart - when have humans ever invented a reliable form of
governance?</p>
<p>There is a rip-roaring final act, that stretched my credulity, but revives the
stakes and entertainment value in what might otherwise be a relentless downer
of a read.</p>
<p>The book, and interviews with the author, caused quite a stir in science
fiction circles. People were extremely angry. The book was attacking their
deeply held beliefs that the future of humanity is as a successfull
space-faring species. They had invested their identity in this world-view,
because of how it serviced their psychological needs for fulfillment and
meaning. They had developed a religious conviction around this particular kind
of fantasy.</p>
<p>The point of Aurora is to highlight the idea of human interstellar colonization
as a dangerous distraction from the very real project of taking care of the
long term health of our planet and our society right here on Earth. It is going
to take <em>beyond</em> miraculous levels of technology and resources to start
thinking about interstellar travel. If, by some miracle, we make it to a year
10,000 utopia, with infinite resources and the wisdom to manage them, then
sure, we can worry about interstellar travel. But for now, can we just focus on
some of the very basic problems of existence here on Earth, like how to make
everyone fed and liberated, educated and fulfilled, without killing our planet
to do it? Maybe invent some sort of government that is reliably able to do
that? That would be nice.</p>
<p><br style="clear: left"></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/fully-operational/" class="u-url">Fully Operational</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/fully-operational/" rel="bookmark">
            <time class="published dt-published" datetime="2023-09-21T10:51:12-05:00" itemprop="datePublished" title="2023-09-21 10:51">2023-09-21 10:51</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Now witness the power of this fully armed and operational battle station.</p>
<p><img alt="My desk featuring too many computers" src="files/2023/desk-with-computers.webp"></p>
<p>New job means new laptop means it's time to clean and re-org the desk.</p>
<dl>
<dt>Leftmost blue skies</dt>
<dd>Linux laptop (a free hand-me-down from a job ten years ago). Acting as the
house Plex / streaming media server, usually tucked away more discreetly than
this.</dd>
<dt>Left top green forest</dt>
<dd>Heavy duty work / gaming Linux laptop ("hardware bonus" from my last
employer). Has been my primary work machine, but sounds like it's getting
replaced by...</dd>
<dt>Left bottom spaceship drawing</dt>
<dd>Macbook Pro (Brand new! Just unwrapped yesterday. Thank you new employer
<a href="https://lambdalabs.com">Lambda</a>!) Looks like this means I'm returning to
developing on a Mac and VMs, after a full decade on Ubuntu &amp; derivatives.
I'm told Docker for Desktop now behaves better than it used to.</dd>
<dt>Left bottom, under the Mac</dt>
<dd>You can sort of see the 10" whiteboard I use to combat ADHD by writing a
sentence about what I'm <em>supposed</em> to be working on, then I can spot it every
few minutes and drag my mind back to the task in hand. (a technique described
in the fabulous
<a href="https://gamkedo.gumroad.com/l/self-command/">Self Command by Chris DeLeon</a>.</dd>
<dt>Center</dt>
<dd>Main monitor and wireless tenkeyless mechanical keyboard &amp; mouse combo, all
switchable to any of the laptops. Under the keyboard you can sort-of see the
<a href="https://ultrapro.com/collections/gaming-accessories-magic-the-gathering/type_playmat">Magic the Gathering 13x24" gaming mat</a>
(free from local gaming store's MtG lessons) pressed into duty as the world's
most gigantic, beautiful, and luxurious mouse mat.</dd>
<dt>Right monitor, keyboard and mouse</dt>
<dd>are wired to the Windows gaming PC under the desk (not visible). The kiddo's
current <a href="https://store.steampowered.com/app/361420/ASTRONEER/">Astroneer</a>
session is visible. The monitor is switchable to any of the laptops.</dd>
<dt>Right tab</dt>
<dd>Absolute workhorse 12.6" Android tablet on which I do most of my reading,
laid in the picture here just to be gratuitous.</dd>
</dl>
</div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/dhalgren/" class="u-url">Dhalgren</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/dhalgren/" rel="bookmark">
            <time class="published dt-published" datetime="2023-09-01T13:23:19-05:00" itemprop="datePublished" title="2023-09-01 13:23">2023-09-01 13:23</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p><span style="float: left">
<img alt="Dhalgren cover" src="files/2023/dhalgren.webp"></span></p>
<p><em>by Samuel Delaney, 1975</em></p>
<p>It broke me. I need to take another run up to this. Advice welcome.</p>
<p><a href="http://localhost:8000/categories/did-not-finish/"><span style="background:grey; color:white; border-radius: 1em; padding-left: 0.5em; padding-right: 0.5em; padding-top: 2px;">did-not-finish</span></a></p>
<p><br style="clear: left"></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/illustrating-uses-of-ibm-cloud-security-groups/" class="u-url">Illustrating Uses of IBM Cloud Security Groups</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/illustrating-uses-of-ibm-cloud-security-groups/" rel="bookmark">
            <time class="published dt-published" datetime="2023-08-22T21:33:47-05:00" itemprop="datePublished" title="2023-08-22 21:33">2023-08-22 21:33</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <blockquote>
<p>I wrote this high-level public-facing guide while employed by IBM, creating
the security groups feature for IBM Cloud. It
<a href="https://web.archive.org/web/20210418195246/https://www.ibm.com/cloud/blog/illustrating-uses-ibm-cloud-security-groups">used to reside</a>
on the IBM blog, but has recently been replaced by newer content, so I've
preserved it here for posterity.</p>
</blockquote>
<p>This article illustrates a few possible uses of IBM Cloud Security Groups, a
per-instance firewall for IBM Cloud virtual instances.</p>
<h3>Why Use Security Groups?</h3>
<p>Security groups firewall your IBM Cloud applications from nefarious network
traffic, protecting you and your company from the efforts of “industrious
users” trying to bring down your application, or make off with your customer's
credit card details. If those sound like sub-optimal outcomes for your
situation, read on…</p>
<h3>Allow Incoming SSH Connections</h3>
<p>The simplest use of security groups is to allow a single type of network
connection to your instances, blocking all other traffic. For example, to allow
only incoming SSH connections, which are TCP connections on port 22. All other
types of traffic, such as ICMP ‘ping' connections, or TCP connections on other
ports, are blocked. Fig 1. A security group configured to allow incoming SSH</p>
<p><img alt="A diagram representing SSH connections being allowed from support engineer to instances within security group 1, while ping connections are denied" src="files/2023/ibm-cloud/1_allow-ssh-1.webp"></p>
<p><em>Fig 1. A security group configured to allow incoming SSH.</em></p>
<p>When instances 1 &amp; 2 are added to your security group, firewalls are created
directly on those instances,configured to allow or deny the corresponding
traffic. Hence, your support engineer can create SSH connections, but cannot
send arbitrary network traffic.</p>
<h3>Allow SSH from a Specified IP Address</h3>
<p>The above scenario allows SSH connection attempts from any IP address. To
increase security, you might only allow connections from a particular instance.
Fig 2. A security group configured to allow incoming SSH connections (TCP port
22) from a particular IP address.</p>
<p><img alt="A diagram representing SSH conections being allowed from a known IP address to instances within security group 1, while connections from a disgruntled employee at a different IP address are denied" src="files/2023/ibm-cloud/2_allow-ssh-one-ip.webp"></p>
<p><em>Fig 2. A security group configured to allow incoming SSH connections (TCP port
22) from a particular IP address.</em></p>
<p>The security group has been configured with the IP address used by a support
engineer – the single instance that is authorized to make a connection.
Connections from other instances are blocked.</p>
<p>As well as allowing traffic from a single IP address, security groups can be
configured with a CIDR block, to allow traffic from all instances on that
subnet. Fig 3. A security group configured to allow incoming SSH connections
(TCP port 22) from all instances on a given subnet.</p>
<p><img alt="A diagram representing SSH conections being allowed from a known subnet to instances within security group 1, while connections from a hacker at an IP address ouside the subet are denied" src="files/2023/ibm-cloud/3_allow-ssh-subnet.webp"></p>
<p><em>Fig 3. A security group configured to allow incoming SSH connections (TCP port
22) from all instances on a given subnet.</em></p>
<p>The diagram shows instances on an authorized subnet (deploy1 &amp; deploy2),
representing a project CI/CD infrastructure, all being able to make SSH
connections to our protected instances, for example to deploy updates to our
application. Other instances, such as an enterprising hacker, are blocked.</p>
<h3>Allow Application Instances to Access a Distributed Data Store</h3>
<p>Another use case would be to allow application servers to access the nodes of a
distributed data store. To do this, we'll make a few changes to the above
security group configuration.</p>
<p>Firstly, we modify the open port from SSH's 22, to MongoDB's default query API
port of 27017.</p>
<p>Secondly, security group 1 is now allowing the creation of outgoing network
connections, from our application instances, where previously it was allowing
incoming connections. Security group rules can manage traffic in either
direction.</p>
<p>Thirdly, we don't want our data store instances to be unprotected, so we'll put
them into a security group of their own. Since there's now two security groups,
we'll give them names: “app” and “db”.</p>
<p>For now, security group “db” allows all incoming MongoDB queries (TCP
connections on 27017), without restricting the IP addresses allowed to make
connections. We'll fix that soon. Fig 4. Two security groups configured to
allow application servers to send queries to MongoDB nodes on a subnet.</p>
<p><img alt='A diagram representing queries from instances in security group "app" being allowed to connect to port 27017 of the subnet of instances in security group "db", which similarly allows incoming connections on TCP port 27017' src="files/2023/ibm-cloud/4_allow-app-servers-access-db-subnet.webp"></p>
<p><em>Fig 4. Two security groups configured to allow application servers to send
queries to MongoDB nodes on a subnet.</em></p>
<p>For clarity, these diagrams don't show the many connections which are blocked
by this setup - which are, of course, the whole point of security groups.
On the above diagram, blocked connections would include:</p>
<ul>
<li>
<p>On app instances:</p>
<ul>
<li>All incoming connections.</li>
<li>Outgoing connections that aren't TCP, or are on the wrong port.</li>
<li>Outgoing connections to anything other than a DB instance.</li>
</ul>
</li>
<li>
<p>On DB instances:</p>
<ul>
<li>All outgoing connections.</li>
<li>Incoming connections that aren't TCP, or are on the wrong port.</li>
</ul>
</li>
</ul>
<p>This setup does have a couple of problems. It relies on our MongoDB instances
all residing on a single subnet. Worse, as mentioned earlier, it allows any IP
address in the world to make queries to MongoDB. We'll fix both of these next.</p>
<h3>Using Remote Groups to Specify Arbitrary IP Addresses</h3>
<p>Specifying allowed instances using a CIDR block can be inappropriate. It's
often preferable to specify a set of arbitrary IP addresses instead. We can do
this by using a second security group – known as a remote group – to contain
the set of allowed instances. Our first security group can then refer to the
remote group to specify which instances are allowed.</p>
<p>In our example above, we would modify the “app” security group by dropping the
CIDR block, and replacing it with a reference to “db” as a remote security
group.</p>
<p>Similarly, we would modify the “db” group to use “app” as a remote group, only
allowing connections from the members of that group.</p>
<p><img alt='A diagram representing instances in security group "app" being allowed to connect to instances in security group "db", via port 27017 only' src="files/2023/ibm-cloud/5_allow-app-servers-access-db-remote.webp"></p>
<p><em>Fig 5. Two security groups configured to allow application servers to send
queries to MongoDB nodes using remote groups.</em></p>
<p>This has several advantages. Firstly, our data store no longer accepts
malicious queries from hackers all over the internet – only from our app
instances.</p>
<p>Secondly, our data store instances no longer need occupy a subnet, they can
have arbitrary IP addresses.</p>
<p>Because the security groups now specify allowed hosts by referencing each
other, when the members of either group changes, the instance level firewalling
rules on all instances are updated automatically, to allow or deny traffic
based on the new membership.</p>
<p>This configuration starts to show what makes security groups a flexible,
dynamic, low-maintenance solution.</p>
<h3>Accepting Web Requests</h3>
<p>Our application instances aren't any use without a web front end. We put our
web instances into their own security group (“web”), which allows incoming
requests from users on the web, and outgoing API requests to our app instances,
on port 61516.</p>
<p>Similarly, we need to add a second rule to the “app” security group, to allow
incoming requests from “web”. Fig 6. A traditional three-tier application using
remote security groups.</p>
<p><img alt='A diagram representing a user connecting via port 80 to instances in security group "web", which connect to instances in group "app" via port 61516, which connect to group "db" via port 27017' src="files/2023/ibm-cloud/6_web-app-db.webp"></p>
<p><em>Fig 6. A traditional three-tier application using remote security groups.</em></p>
<p>The more types of server we add to our setup, the more benefit “remote” groups
provide, by minimizing setup configuration, and by automatically keeping
firewalling rules up to date when group membership changes.</p>
<p>A future blog post will discuss how to set up this three-tier scenario, and
describe details such as how to use multiple network interfaces on an instance,
such as the web instances which will use a public IP address exposed to users,
versus a private IP exposed to the API instances.</p>
<h3>Add a Bastion</h3>
<p>We need some way to access our servers, so that we can, for example, deploy new
versions of our application. Commonly this is achieved using a bastion server,
which provides a single, carefully hardened point of access.</p>
<p>Here we add a bastion server, and modify all our security groups to allow SSH
access from the bastion to all our instances. The bastion instance itself would
be configured to only allow incoming connections from the appropriate points in
a CI/CD infrastructure (not shown.) Fig 7. Adding a bastion server with SSH
access to all other instances.</p>
<p><img alt='A diagram representing the same elements as figure 6 above, with the addition of a "bastion" group which connects to all instances via SSH on port 22' src="files/2023/ibm-cloud/7_bastion.webp"></p>
<p><em>Fig 7. Adding a bastion server with SSH access to all other instances.</em></p>
<p>This is starting to look like a realistic setup for a modest but scalable
multi-tier application.</p>
<h3>Conclusion</h3>
<p>Security groups are a flexible and powerful way to firewall network traffic to
and from your system's instances. We've shown how they might be used in a few
typical scenarios, and hopefully demonstrated that they are flexible enough to
accommodate many others. For more information, see
<a href="https://cloud.ibm.com/docs/security-groups/sg_index.html">Getting Started with Security Groups</a>.</p>
<hr>
<p><span style="float: left">
<img alt="Jonathan Hartley's smiley face" src="files/2023/ibm-cloud/jonathan-hartley.webp"></span>
<br><strong>Jonathan Hartley</strong><br>
Senior Cloud Developer</p>
<p><span style="float: none"></span></p>
<p></p>
<p></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/til-git-push-force-with-lease/" class="u-url">TIL: git push --force-with-lease</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Jonathan Hartley
            </span></p>
            <p class="dateline">
            <a href="posts/til-git-push-force-with-lease/" rel="bookmark">
            <time class="published dt-published" datetime="2023-08-04T13:48:19-05:00" itemprop="datePublished" title="2023-08-04 13:48">2023-08-04 13:48</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Don't ever type <code>git push --force</code>. Yes, there are times we have to hold our
nose and do a force push. Maybe the project requires contributions to be
rebased or squashed. Maybe we pushed the nuclear launch codes. But there are
failure modes:</p>
<ul>
<li>You might be accidentally pushing to or from the wrong branch, and hence are
  about to blow away valuable work at the remote. Yes, is unlikely, and can be
  fixed after the fact, but who knows how much embarrassing disruption and
  confusion you'll cause the team before you realize what you did.</li>
<li>Do you <em>always</em> remember to check the state of the remote, to make sure there
  isn't unexpected extra commits on the remote that you'll unknowingly blow
  away when you push? Do you enjoy always having to type those extra commands
  to pull and check the remote commits?</li>
<li>No matter how conscientious we are about checking the above, there is a race
  condition. We might check the remote, then someone else pushes valuable
  changes, then we force push and blow them away.</li>
</ul>
<p>Although there are conventions that can help with all the above (e.g. only ever
force pushing to your own fork, to which nobody else ever pushes), they aren't
generally watertight. (e.g. you might have pushed something yourself, before
vacation, and forgotten about it.)</p>
<p>So the generally agreed method to avoid the above failure modes is "be more
careful", which sounds to me like the common prelude to failure. What we need
are push's newer command-line options:</p>
<dl>
<dt><code>--force-with-lease</code></dt>
<dd>Like <code>--force</code>, but refuses to push if the remote ref doesn't point at the
same commit that our local remote-tracking branch 'origin/mybranch' thinks it
should. So if someone else pushes something to the remote's 'mybranch' just
before we try to force push, our push will fail until we pull (and, in theory,
inspect) those commits that we were about to blow away.</dd>
</dl>
<p>It turns out that this is inadequate. One might have fetched an up-to-date remote
branch, but somehow or other ended up with our local HEAD on a divergent branch
anyway:</p>
<div class="code"><pre class="code literal-block">C origin/mybranch
|
B¹   B² HEAD mybranch
 \ /
  A
  |
</pre></div>

<p>In this situation, <code>--force-with-lease</code> will allow us to push, not only blowing
away the original commit B¹, as we intended, but also C, which was maybe pushed
by someone else before we fetched.</p>
<p>To guard against this, we can use the even newer option:</p>
<dl>
<dt><code>--force-if-includes</code></dt>
<dd>This makes <code>--force-with-lease</code> even more strict about rejecting pushes,
using clever heuristics on your local reflog, to check that the remote ref
being updated doesn't include commits which have never been part of your local
branch.</dd>
</dl>
<p>Upshot is, I plan to default to always replacing uses of <code>--force</code> with:</p>
<div class="code"><pre class="code literal-block">git<span class="w"> </span>push<span class="w"> </span>--force-with-lease<span class="w"> </span>--force-if-includes<span class="w"> </span>...
</pre></div>

<p>That's a lot to type, the options don't have short versions, and it's easy to forget to
do. Hence, shadow <code>git</code> to enforce it, and make it easy. In .bashrc or similar:</p>
<div class="code"><pre class="code literal-block"><span class="c1"># Shadow git to warn againt the use of 'git push -f'</span>
git<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nv">is_push</span><span class="o">=</span><span class="nb">false</span>
<span class="w">    </span><span class="nv">is_force</span><span class="o">=</span><span class="nb">false</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span>arg<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="o">[</span><span class="w"> </span><span class="s2">"</span><span class="nv">$arg</span><span class="s2">"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"push"</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">is_push</span><span class="o">=</span><span class="nb">true</span>
<span class="w">        </span><span class="o">[</span><span class="w"> </span><span class="s2">"</span><span class="nv">$arg</span><span class="s2">"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"-f"</span><span class="w"> </span>-o<span class="w"> </span><span class="s2">"</span><span class="nv">$arg</span><span class="s2">"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"--force"</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">is_force</span><span class="o">=</span><span class="nb">true</span>
<span class="w">    </span><span class="k">done</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">"</span><span class="nv">$is_push</span><span class="s2">"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">"</span><span class="nv">$is_force</span><span class="s2">"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="c1"># Suggest alternative commands.</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">"git push -f: Consider 'git push --force-with-lease --force-if-includes' instead, which is aliased to 'gpf'"</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>
<span class="w">    </span><span class="c1"># Run the given command, using the git executable instead of this function.</span>
<span class="w">    </span><span class="k">$(</span>which<span class="w"> </span>git<span class="k">)</span><span class="w"> </span><span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
<span class="o">}</span>

<span class="c1"># git push force: using the new, safer alternatives to --force</span>
gpf<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="c1"># Older versions of git don't have --force-if-includes. Fallback to omitting it.</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span>!<span class="w"> </span>git<span class="w"> </span>push<span class="w"> </span>--quiet<span class="w"> </span>--force-with-lease<span class="w"> </span>--force-if-includes<span class="w"> </span><span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">      </span>git<span class="w"> </span>push<span class="w"> </span>--quiet<span class="w"> </span>--force-with-lease<span class="w"> </span><span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>
</pre></div>

<p>Then trying to do it wrong tells you how to easily do it right:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>git<span class="w"> </span>push<span class="w"> </span>-f
git<span class="w"> </span>push<span class="w"> </span>-f:<span class="w"> </span>Consider<span class="w"> </span><span class="s1">'git push --force-with-lease --force-if-includes'</span><span class="w"> </span>instead,<span class="w"> </span>which<span class="w"> </span>is<span class="w"> </span>aliased<span class="w"> </span>to<span class="w"> </span><span class="s1">'gpf'</span>
<span class="o">[</span><span class="m">1</span><span class="o">]</span>
$<span class="w"> </span>gpf
$
</pre></div>

<p>(The [1] is my prompt telling me that the last command had an error exit value.)</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="next">
                <a href="index-28.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer"></footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
